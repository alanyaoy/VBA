
yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA
$ git clone https://github.com/alanyaoy/VBA.git
Cloning into 'VBA'...
remote: Counting objects: 3, done.
remote: Total 3 (delta 0), reused 0 (delta 0), pack-reused 0
Unpacking objects: 100% (3/3), done.

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA
$ git status
fatal: not a git repository (or any of the parent directories): .git

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA
$ cd vba

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git status
On branch master
Your branch is up to date with 'origin/master'.

Untracked files:
  (use "git add <file>..." to include in what will be committed)

        GWF_VBA_Code_Work.xlsm

nothing added to commit but untracked files present (use "git add" to track)

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git add -A

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git status
On branch master
Your branch is up to date with 'origin/master'.

Changes to be committed:
  (use "git reset HEAD <file>..." to unstage)

        new file:   GWF_VBA_Code_Work.xlsm


yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git commit -m " Add VBA master code file to Github account"
[master fcf6bd7]  Add VBA master code file to Github account
 Committer: alanyaoy <yaoa@hunterdouglas.com.au>
Your name and email address were configured automatically based
on your username and hostname. Please check that they are accurate.
You can suppress this message by setting them explicitly:

    git config --global user.name "Your Name"
    git config --global user.email you@example.com

After doing this, you may fix the identity used for this commit with:

    git commit --amend --reset-author

 1 file changed, 0 insertions(+), 0 deletions(-)
 create mode 100644 GWF_VBA_Code_Work.xlsm

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git push
Enumerating objects: 4, done.
Counting objects: 100% (4/4), done.
Delta compression using up to 4 threads.
Compressing objects: 100% (3/3), done.
Writing objects: 100% (3/3), 2.75 MiB | 252.00 KiB/s, done.
Total 3 (delta 0), reused 0 (delta 0)
To https://github.com/alanyaoy/VBA.git
   96124d8..fcf6bd7  master -> master

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git status
On branch master
Your branch is up to date with 'origin/master'.

Untracked files:
  (use "git add <file>..." to include in what will be committed)

        Git_Cmd_History.c
        Git_Cmd_Knowledgebase.docx
        ~$t_Cmd_Knowledgebase.docx

nothing added to commit but untracked files present (use "git add" to track)

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git add .

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git commit -m "add Git_Cmd history file & Knowledgebase file"
[master 215196b] add Git_Cmd history file & Knowledgebase file
 Committer: alanyaoy <yaoa@hunterdouglas.com.au>
Your name and email address were configured automatically based
on your username and hostname. Please check that they are accurate.
You can suppress this message by setting them explicitly:

    git config --global user.name "Your Name"
    git config --global user.email you@example.com

After doing this, you may fix the identity used for this commit with:

    git commit --amend --reset-author

 3 files changed, 756 insertions(+)
 create mode 100644 Git_Cmd_History.c
 create mode 100644 Git_Cmd_Knowledgebase.docx
 create mode 100644 ~$t_Cmd_Knowledgebase.docx

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git push
Enumerating objects: 6, done.
Counting objects: 100% (6/6), done.
Delta compression using up to 4 threads.
Compressing objects: 100% (5/5), done.
Writing objects: 100% (5/5), 14.85 KiB | 7.42 MiB/s, done.
Total 5 (delta 0), reused 0 (delta 0)
To https://github.com/alanyaoy/VBA.git
   fcf6bd7..215196b  master -> master

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git add .gitignore
fatal: pathspec '.gitignore' did not match any files

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ touch .gitignore

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git status
On branch master
Your branch is up to date with 'origin/master'.

Changes not staged for commit:
  (use "git add/rm <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

        modified:   Git_Cmd_Knowledgebase.docx
        deleted:    ~$t_Cmd_Knowledgebase.docx

Untracked files:
  (use "git add <file>..." to include in what will be committed)

        .gitignore
        VBA_Button_On_Excel.xlsx
        ~$GWF_VBA_Code_Work.xlsm
        ~$VBA_Button_On_Excel.xlsx

no changes added to commit (use "git add" and/or "git commit -a")

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git add .gitignore

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git status
On branch master
Your branch is up to date with 'origin/master'.

Changes to be committed:
  (use "git reset HEAD <file>..." to unstage)

        new file:   .gitignore

Changes not staged for commit:
  (use "git add/rm <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

        modified:   Git_Cmd_Knowledgebase.docx
        deleted:    ~$t_Cmd_Knowledgebase.docx

Untracked files:
  (use "git add <file>..." to include in what will be committed)

        VBA_Button_On_Excel.xlsx
        ~$GWF_VBA_Code_Work.xlsm
        ~$VBA_Button_On_Excel.xlsx


yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git add .
error: open("~$GWF_VBA_Code_Work.xlsm"): Permission denied
error: unable to index file ~$GWF_VBA_Code_Work.xlsm
fatal: adding files failed

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git add .
error: open("~$VBA_Button_On_Excel.xlsx"): Permission denied
error: unable to index file ~$VBA_Button_On_Excel.xlsx
fatal: adding files failed

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git add .

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git status
On branch master
Your branch is up to date with 'origin/master'.

Changes to be committed:
  (use "git reset HEAD <file>..." to unstage)

        new file:   .gitignore
        modified:   GWF_VBA_Code_Work.xlsm
        modified:   Git_Cmd_Knowledgebase.docx
        new file:   VBA_Button_On_Excel.xlsx
        deleted:    ~$t_Cmd_Knowledgebase.docx


yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git commit -m "add VBA button file & .gitignore file"
[master de62ab1] add VBA button file & .gitignore file
 Committer: alanyaoy <yaoa@hunterdouglas.com.au>
Your name and email address were configured automatically based
on your username and hostname. Please check that they are accurate.
You can suppress this message by setting them explicitly:

    git config --global user.name "Your Name"
    git config --global user.email you@example.com

After doing this, you may fix the identity used for this commit with:

    git commit --amend --reset-author

 5 files changed, 0 insertions(+), 0 deletions(-)
 create mode 100644 .gitignore
 rewrite Git_Cmd_Knowledgebase.docx (69%)
 create mode 100644 VBA_Button_On_Excel.xlsx
 delete mode 100644 ~$t_Cmd_Knowledgebase.docx

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git push
Enumerating objects: 9, done.
Counting objects: 100% (9/9), done.
Delta compression using up to 4 threads.
Compressing objects: 100% (5/5), done.
Writing objects: 100% (6/6), 2.89 MiB | 260.00 KiB/s, done.
Total 6 (delta 0), reused 0 (delta 0)
To https://github.com/alanyaoy/VBA.git
   215196b..de62ab1  master -> master

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git status
On branch master
Your branch is up to date with 'origin/master'.

Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

        modified:   .gitignore

Untracked files:
  (use "git add <file>..." to include in what will be committed)

        Git_Cmd_History.txt
        ~$VBA_Button_On_Excel.xlsx

no changes added to commit (use "git add" and/or "git commit -a")

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git add .
error: open("~$VBA_Button_On_Excel.xlsx"): Permission denied
error: unable to index file ~$VBA_Button_On_Excel.xlsx
fatal: adding files failed

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git add .

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git status
On branch master
Your branch is up to date with 'origin/master'.

Changes to be committed:
  (use "git reset HEAD <file>..." to unstage)

        modified:   .gitignore
        new file:   Git_Cmd_History.txt


yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git commit -m "add Git_Cmd_History.txt file and hide/ignore Git_Cmd_History.c file"
[master 4dddfe3] add Git_Cmd_History.txt file and hide/ignore Git_Cmd_History.c file
 Committer: alanyaoy <yaoa@hunterdouglas.com.au>
Your name and email address were configured automatically based
on your username and hostname. Please check that they are accurate.
You can suppress this message by setting them explicitly:

    git config --global user.name "Your Name"
    git config --global user.email you@example.com

After doing this, you may fix the identity used for this commit with:

    git commit --amend --reset-author

 2 files changed, 757 insertions(+)
 create mode 100644 Git_Cmd_History.txt

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git push
Enumerating objects: 5, done.
Counting objects: 100% (5/5), done.
Delta compression using up to 4 threads.
Compressing objects: 100% (2/2), done.
Writing objects: 100% (3/3), 328 bytes | 328.00 KiB/s, done.
Total 3 (delta 1), reused 0 (delta 0)
remote: Resolving deltas: 100% (1/1), completed with 1 local object.
To https://github.com/alanyaoy/VBA.git
   de62ab1..4dddfe3  master -> master

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git status
On branch master
Your branch is up to date with 'origin/master'.

nothing to commit, working tree clean

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git status
On branch master
Your branch is up to date with 'origin/master'.

Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

        modified:   .gitignore

no changes added to commit (use "git add" and/or "git commit -a")

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git add .

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git status
On branch master
Your branch is up to date with 'origin/master'.

Changes to be committed:
  (use "git reset HEAD <file>..." to unstage)

        modified:   .gitignore


yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git commit -m "add star to .gitignore"
[master 80570ef] add star to .gitignore
 Committer: alanyaoy <yaoa@hunterdouglas.com.au>
Your name and email address were configured automatically based
on your username and hostname. Please check that they are accurate.
You can suppress this message by setting them explicitly:

    git config --global user.name "Your Name"
    git config --global user.email you@example.com

After doing this, you may fix the identity used for this commit with:

    git commit --amend --reset-author

 1 file changed, 1 insertion(+), 1 deletion(-)

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git push
Enumerating objects: 5, done.
Counting objects: 100% (5/5), done.
Delta compression using up to 4 threads.
Compressing objects: 100% (2/2), done.
Writing objects: 100% (3/3), 284 bytes | 284.00 KiB/s, done.
Total 3 (delta 1), reused 0 (delta 0)
remote: Resolving deltas: 100% (1/1), completed with 1 local object.
To https://github.com/alanyaoy/VBA.git
   4dddfe3..80570ef  master -> master

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git status
On branch master
Your branch is up to date with 'origin/master'.

Untracked files:
  (use "git add <file>..." to include in what will be committed)

        MI_Code.txt
        ~$GWF_VBA_Code_Work.xlsm

nothing added to commit but untracked files present (use "git add" to track)

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git status
On branch master
Your branch is up to date with 'origin/master'.

Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

        modified:   GWF_VBA_Code_Work.xlsm

Untracked files:
  (use "git add <file>..." to include in what will be committed)

        MI_Code.txt

no changes added to commit (use "git add" and/or "git commit -a")

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git add .

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git status
On branch master
Your branch is up to date with 'origin/master'.

Changes to be committed:
  (use "git reset HEAD <file>..." to unstage)

        modified:   GWF_VBA_Code_Work.xlsm
        new file:   MI_Code.txt


yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git commit -m "add MI_Code.txt"
[master 7f78b9e] add MI_Code.txt
 Committer: alanyaoy <yaoa@hunterdouglas.com.au>
Your name and email address were configured automatically based
on your username and hostname. Please check that they are accurate.
You can suppress this message by setting them explicitly:

    git config --global user.name "Your Name"
    git config --global user.email you@example.com

After doing this, you may fix the identity used for this commit with:

    git commit --amend --reset-author

 2 files changed, 324 insertions(+)
 create mode 100644 MI_Code.txt

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git push
Enumerating objects: 6, done.
Counting objects: 100% (6/6), done.
Delta compression using up to 4 threads.
Compressing objects: 100% (4/4), done.
Writing objects: 100% (4/4), 2.75 MiB | 211.00 KiB/s, done.
Total 4 (delta 1), reused 0 (delta 0)
remote: Resolving deltas: 100% (1/1), completed with 1 local object.
To https://github.com/alanyaoy/VBA.git
   80570ef..7f78b9e  master -> master

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git status
On branch master
Your branch is up to date with 'origin/master'.

Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

        modified:   MI_Code.txt

no changes added to commit (use "git add" and/or "git commit -a")

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git diff
diff --git a/MI_Code.txt b/MI_Code.txt
index a37aef9..9d2ce3e 100644
--- a/MI_Code.txt
+++ b/MI_Code.txt
@@ -1,5 +1,8 @@
-       ---first sumarize PO by month ---
-                with po as (
+
+       use JDE_DB_Alan
+       go
+
+       with po as (
                                                 select tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb.Trans                                                                            actionOriginator,tb.TransactionOrigName,tb.SupplierName
                                                                ,sum(tb.PO_Volume) as PO_Vol
                                                        from JDE_DB_Alan.vw_OpenPO tb
@@ -9,20 +12,22 @@
                                          )
                                        --select * from po

-                                       ---  Need to aggregate FC for Single SKU ---  1/8/2018
+                                       ---====================================================
+                                       ---  Need to Aggregate FC Value for Single SKU ---  1/8/2018
+                                       ---=====================================================
                    ,mi2fc as ( select mi2.ItemID,mi2.Date,mi2.ValidStatus,sum(mi2.Value) as value
                                                                from JDE_DB_Alan.FCPRO_MI_2_Raw_Data_tmp mi2
                                                                where mi2.ValidStatus = 'Y'
                                                                --where mi2.ValidStatus = 'S'
        -- ' S' denotes for Simulation only   --- 2/8/2018 --- only pickup S items for Simulation, when MI confirmed you need to put Y instead of S
                                                                 and mi2.Value >0
                        --- Need to pick up non Zero value  --3/8/2018
-                                                                  --  and mi2.ItemID in ('18.010.035')
+                                                                    --and mi2.ItemID in ('18.010.035')
                                                                group by mi2.ItemID,mi2.date,mi2.ValidStatus
:...skipping...
diff --git a/MI_Code.txt b/MI_Code.txt
index a37aef9..9d2ce3e 100644
--- a/MI_Code.txt
+++ b/MI_Code.txt
@@ -1,5 +1,8 @@
-       ---first sumarize PO by month ---
-                with po as (
+
+       use JDE_DB_Alan
+       go
+
+       with po as (
                                                 select tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb.TransactionOriginator,tb.TransactionOrigName,tb.SupplierName
                                                                ,sum(tb.PO_Volume) as PO_Vol
                                                        from JDE_DB_Alan.vw_OpenPO tb
@@ -9,20 +12,22 @@
                                          )
                                        --select * from po

-                                       ---  Need to aggregate FC for Single SKU ---  1/8/2018
+                                       ---====================================================
+                                       ---  Need to Aggregate FC Value for Single SKU ---  1/8/2018
+                                       ---=====================================================
                    ,mi2fc as ( select mi2.ItemID,mi2.Date,mi2.ValidStatus,sum(mi2.Value) as value
                                                                from JDE_DB_Alan.FCPRO_MI_2_Raw_Data_tmp mi2
                                                                where mi2.ValidStatus = 'Y'
                                                                --where mi2.ValidStatus = 'S'                                                           -- ' S' denotes for Simulation only   --- 2/8/2018 --- only pickup S ito put Y instead of S
                                                                 and mi2.Value >0                                                                                       --- Need to pick up non Zero value  --3/8/2018
-                                                                  --  and mi2.ItemID in ('18.010.035')
+                                                                    --and mi2.ItemID in ('18.010.035')
                                                                group by mi2.ItemID,mi2.date,mi2.ValidStatus
                                                                )
                    -- select distinct mi2fc.ItemID from mi2fc
                                  -- FC --- updated 12/7/2018 to include MI in table variable ( Or Temp table)
                                  ,fc_mas as ( select * from JDE_DB_Alan.vw_FC f
                                                        --where f.ItemNumber in ('18.010.035','42.210.031')                     -- deliberately choose 2 items in vw_FC, 1 is 18.010.035 which also exists in MI_orig table, 1 but exists in vw_FC master table to check what result it will yield after Join --- 25/7/2018
-                                                         -- where f.ItemNumber in ('26.800.833')
+                                                        --  where f.ItemNumber in ('26.800.833','18.010.035')
                                                                -- and f.Date < '2019-03-02'                                                            -- choose small date range to return small data set for easy manupilati
                                                           )
                                  ,_fc as
@@ -37,6 +42,10 @@
                                                     from fc_mas f full outer join mi2fc f_ on f.ItemNumber = f_.ItemID and f.Date = f_.Date                                            -- 1/8/2018, Need to combine multip ent will have all data (includes 18.013.089) but big recordsets, because you are picking up all SKUs in 'Master' file regardless if they have forecast or not ( currently you filter out items has no sales history over last 12 m

                                                 )
                                  -- select * from _fc where _fc.ItemID in ('18.013.089')
+
+                                  ---===================================================
+                                  --- Get your Final list with Item/FC_Vol/Date etc ---
+                                  ---===================================================
                                 ,fc as
                                           ( select f.ItemID,f.myFcDate,f.myFcQty,f.ItemNumber,f.Date,f.FCDate_,f.FC_Vol
                                                                ,case when f.myFcQty is null then f.FC_Vol                                                                                              -- if Item doest not ex
@@ -67,10 +76,11 @@
                                                 )

                                  -- select distinct fc.ItemNumber from fc
-                                 --select  * from fc  where fc.ItemNumber_f in ('18.013.089')
+                                -- select  * from fc  where fc.ItemNumber_f in ('18.013.089')
                                  --select  * from fc  where fc.ItemID in ('18.013.089') or fc.ItemNumber_f in ('18.013.089')                   --- note 18.013.089 has no existence in 'FVPRO_Fcst' table as there is no salese you will have unexpected result - be careful here in where condition be careful to which ItemNumber or ItemId you need to use. Also be careful using 'Not In ( )' conditional because if there is null value SQL will return
-                                  --select * from fc
+                                --  select * from fc where fc.ItemNumber_f in ('709895')

+                                   --- Join PO and Item Master ---
                                        ,tb as
                                                ( select f.ItemNumber_f,f.FcDate_f,f.Date_f,f.FC_Vol_f as FC_Vol                                -- will it cause issues if you rename 'f.FC_Vol_f' as 'FC_Vol' since you alread
                                                         -- select f.ItemNumber,f.Date,f.FCDate_,f.FC_Vol_f
@@ -91,8 +101,12 @@
                                                          -- and f.ItemNumber in ('45.103.000')
                                                                         )

-                                  --select * from tb where tb.ItemNumber_f in ('18.013.089') order by tb.ItemNumber_f,tb.FCDate_f
-                                         ,tb_ as (
+                                    --select * from tb where tb.ItemNumber_f in ('18.013.089') order by tb.ItemNumber_f,tb.FCDate_f
+
+                                         ---==================================================================
+                                         --- Get your Ezi plan format( Open stock/End stock/PO/Week Cover) ---
+                                         ---==================================================================
+                                        ,tb_ as (
                                                                select tb.ItemNumber_f,tb.Date_f,tb.FCDate_f,tb.FC_Vol,tb.PO_Vol,tb.SOH_Vol
                                                                                ,case
                                                                                           when tb.Date_f >DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)  then (tb.PO_Vol -tb.FC_Vol)
@@ -155,9 +169,10 @@
                                                                                          --  end as mywholesaleprice
                                                                                --from t_ left join pri on t_.ItemNumber = pri.ItemNumber )

-                                               ---===========================================================================================================
+                                               --===================================================================================
                                                --- Filter out Item does not exist using inner join Or O/U items ( discontinued) by using stocking type filter
-                                               ---===========================================================================================================
+                                               ---===================================================================================
+
                                          ,_t as ( --select t_.ItemNumber,t_.Date,t_.FCDate_,t_.FC_Vol,t_.PO_Vol,t_.SOH_Vol,t_.SOH_Vol_,t_.Final_SOH_Begin_M_,t_.SOH_End_M_,m.WholeSalePrice     -- will spit out column by col 14/5/2018
                                                                        select t_.*
                                                                                        , mm.WholeSalePrice as Mywholesaleprice
@@ -179,18 +194,19 @@
                                                                        --from t_ left join JDE_DB_Alan.vw_Mast mm on t_.ItemNumber_f = mm.ItemNumber   )                               -- note that 'vw_Mast ' has clean data,son )  - 23/7/2018
                                                                          from t_ inner join JDE_DB_Alan.vw_Mast mm on t_.ItemNumber_f = mm.ItemNumber                                  -- Use inner join to filter out SKUs no', so SKUs against AWF will filter out ( like in CommonWealth Bank Proj - '7089895','709901' ) -- 23/7/2018
                                                                        --  where mm.StockingType not in ('O','U')                                                                                                             ' - project Comwlth Bank Project. Should keep sku has no sales history over last 12 months like '18.013.089'  in Proj RAMLER -- 7/8/2018
-                                                                       --  where mm.StockingType in ('O','K','W','X','S','F','P','U','Q','Z','C','M','0','I')
+                                                                       --  where mm.StockingType in ('O','K','W','X','S','F','P','U','Q','Z','C','M','0','I')
                                                                          where mm.StockingType in ('K','W','X','S','F','P','Q','Z','C','M','0','I') --or mm.StockingType is null                                  -- this coulSet due to Null value --- 23/7/2018
                                                                                                )

-                                               -- select * from _t
-                                               --  where _t.ItemNumber_f in ('32.501.000','709895','82.691.909','18.013.089','42.210.031')
-                                                       --where _t.ItemNumber in ('45.103.000','45.200.100','42.210.031')
+                                                --select * from _t
+                                                       --where _t.ItemNumber_f in ('32.501.000','709895','18.013.089','82.691.909','42.210.031')
+                                                       --where _t.ItemNumber_f in ('45.103.000','45.200.100','42.210.031')
                                                         -- where _t.ItemNumber in ('0751031003001H')
                                                         --order by _t.ItemNumber,_t.Date

                                                --select _t.ItemNumber_f,_t.Date_f d1,_t.FCDate_f d2,'Start_Stk' as DataType,_t.Final_SOH_Begin_M_ as value,_t.Stk_Out_Stauts,_t.Owner_,_t.PrimarySupplier,_t.Description,_t.FarNumber from _t

+                                        -- Combine all your planning data together --
                                         ,com as ( select _t.ItemNumber_f,_t.Date_f d1,_t.Date_f_2 d3,_t.FCDate_f d2,'FC_Qty' as DataType,_t.FC_Vol as Value,_t.Stk_Out_Stauts,_t.Owner_,_t.PrimarySupplier,_t.Description,_t.FerNumber from _t
                                                                   union all
                                                                   select _t.ItemNumber_f,_t.Date_f d1,_t.Date_f_2 d3,_t.FCDate_f d2,'PO_Qty' as DataType,_t.PO_Vol as value,_t.Stk_Out_Stauts,_t.Owner_,_t.PrimarySupplier,_t.ime_Mth,_t.PlannerNumber from _t
@@ -210,8 +226,14 @@
                                                                   )

                                        -- select distinct com.ItemNumber_f from com
+                               ,stg as ( select * from com where com.ItemNumber_f in ('32.501.000','709895','18.013.089','82.691.909','42.210.031') )          -- For testing purpose
+
+                                   ---======================================================
+                                   --Only Pick up Items in Markeing Intelligence File ---
+                                       ---======================================================
                                ,fcst as
-                                                (select * from com
+                                                (--select * from stg as com                                                                                                    --- For testing purpose
+                                                  select * from com
                                                         --where com.Stk_Out_Stauts in ('Y')
                                                           -- where com.ItemNumber in ('45.103.000','45.200.100')
                                                        --where com.ItemNumber in ('4152336048B')
@@ -231,12 +253,17 @@

                                                        --order by com.ItemNumber_f,com.DataType,com.d2
                                                           )
-                                         --select * from fcst where fcst.ItemNumber_f is null
+                                         --select * from fcst
+                                         -- where fcst.ItemNumber_f in ('32.501.000','709895','18.013.089','82.691.909','42.210.031')
+                                         --where fcst.ItemNumber_f is null
                                          --where fcst.ItemNumber_f in ('18.010.035')

-
-                                 --- Get Preparation to Pivot Data using SQL --- It is better to use Numbwe Array ([1],[2],[3] ) instead of ([201807],[201808],[201809]) as it is more versatile and flexible to avoid hard co
-                               ,R(N,_T,T_,T,XX,YY,start) AS
+                                ---=======================
+                                --- Transform your data ---
+                                ---=======================
+                                --- Get Preparation to Pivot Data using SQL --- It is better to use Numbwe Array ([1],[2],[3] ) instead of ([201807],[201808],[201809]) as it is more versatile and flexible to avoid hard cod
+                                --;with
+                                 ,R(N,_T,T_,T,XX,YY,start) AS
                                                (
                                                 select 1 as N,-24 as _T,24 as T_,-23 as T,24 as XX,24 as YY,cast(DATEADD(mm, DATEDIFF(mm, 0, GETDATE())-24, 0) as datetime) as start      -- pay attention T starts -23,you nent month you start as 1, otherwise you can use XX field
                                                 UNION ALL
@@ -256,7 +283,7 @@
                                        --select * from r
                                        --select R.N,case when R._T < 0 then R.T_ else R._T end as T, start from R
                                        --select R.N,case when R._T < 0 then R.T_ else R.YY end as T, start from R
-                                 ,MthCal as (
', so SKUs against AWF will filter out ( like in CommonWealth Bank Proj - '7089895','709901' ) -- 23/7/2018
                                                                        --  where mm.StockingType not in ('O','U')
' - project Comwlth Bank Project. Should keep sku has no sales history over last 12 months like '18.013.089'  in Proj RAMLER -- 7/8/2018
-                                                                       --  where mm.StockingType in ('O','K','W','X','S','F','P','U','Q','Z','C','M','0','I')
+                                                                       --  where mm.StockingType in ('O','K','W','X','S','F','P','U','Q','Z','C','M','0','I')
                                                                          where mm.StockingType in ('K','W','X','S','F','P','Q','Z','C','M','0','I') --or mm.StockingType is null                                  -- this coul
Set due to Null value --- 23/7/2018
                                                                                                )

-                                               -- select * from _t
-                                               --  where _t.ItemNumber_f in ('32.501.000','709895','82.691.909','18.013.089','42.210.031')
-                                                       --where _t.ItemNumber in ('45.103.000','45.200.100','42.210.031')
+                                                --select * from _t
+                                                       --where _t.ItemNumber_f in ('32.501.000','709895','18.013.089','82.691.909','42.210.031')
+                                                       --where _t.ItemNumber_f in ('45.103.000','45.200.100','42.210.031')
                                                         -- where _t.ItemNumber in ('0751031003001H')
                                                         --order by _t.ItemNumber,_t.Date

                                                --select _t.ItemNumber_f,_t.Date_f d1,_t.FCDate_f d2,'Start_Stk' as DataType,_t.Final_SOH_Begin_M_ as value,_t.Stk_Out_Stauts,_t.Owner_,_t.PrimarySupplier,_t.Description,_t.Fa
rNumber from _t

+                                        -- Combine all your planning data together --
                                         ,com as ( select _t.ItemNumber_f,_t.Date_f d1,_t.Date_f_2 d3,_t.FCDate_f d2,'FC_Qty' as DataType,_t.FC_Vol as Value,_t.Stk_Out_Stauts,_t.Owner_,_t.PrimarySupplier,_t.Description,_t.F
erNumber from _t
                                                                   union all
                                                                   select _t.ItemNumber_f,_t.Date_f d1,_t.Date_f_2 d3,_t.FCDate_f d2,'PO_Qty' as DataType,_t.PO_Vol as value,_t.Stk_Out_Stauts,_t.Owner_,_t.PrimarySupplier,_t.
ime_Mth,_t.PlannerNumber from _t
@@ -210,8 +226,14 @@
                                                                   )

                                        -- select distinct com.ItemNumber_f from com
+                               ,stg as ( select * from com where com.ItemNumber_f in ('32.501.000','709895','18.013.089','82.691.909','42.210.031') )          -- For testing purpose
+
+                                   ---======================================================
+                                   --Only Pick up Items in Markeing Intelligence File ---
+                                       ---======================================================
                                ,fcst as
-                                                (select * from com
+                                                (--select * from stg as com                                                                                                    --- For testing purpose
+                                                  select * from com
                                                         --where com.Stk_Out_Stauts in ('Y')
                                                           -- where com.ItemNumber in ('45.103.000','45.200.100')
                                                        --where com.ItemNumber in ('4152336048B')
@@ -231,12 +253,17 @@

                                                        --order by com.ItemNumber_f,com.DataType,com.d2
                                                           )
-                                         --select * from fcst where fcst.ItemNumber_f is null
+                                         --select * from fcst
+                                         -- where fcst.ItemNumber_f in ('32.501.000','709895','18.013.089','82.691.909','42.210.031')
+                                         --where fcst.ItemNumber_f is null
                                          --where fcst.ItemNumber_f in ('18.010.035')

-
-                                 --- Get Preparation to Pivot Data using SQL --- It is better to use Numbwe Array ([1],[2],[3] ) instead of ([201807],[201808],[201809]) as it is more versatile and flexible to avoid hard co
-                               ,R(N,_T,T_,T,XX,YY,start) AS
+                                ---=======================
+                                --- Transform your data ---
+                                ---=======================
+                                --- Get Preparation to Pivot Data using SQL --- It is better to use Numbwe Array ([1],[2],[3] ) instead of ([201807],[201808],[201809]) as it is more versatile and flexible to avoid hard cod
+                                --;with
+                                 ,R(N,_T,T_,T,XX,YY,start) AS
                                                (
                                                 select 1 as N,-24 as _T,24 as T_,-23 as T,24 as XX,24 as YY,cast(DATEADD(mm, DATEDIFF(mm, 0, GETDATE())-24, 0) as datetime) as start      -- pay attention T starts -23,you ne
nt month you start as 1, otherwise you can use XX field
                                                 UNION ALL
@@ -256,7 +283,7 @@
                                        --select * from r
                                        --select R.N,case when R._T < 0 then R.T_ else R._T end as T, start from R
                                        --select R.N,case when R._T < 0 then R.T_ else R.YY end as T, start from R
-                                 ,MthCal as (
+                        ,MthCal as (
                                                                        select  n as rnk
                                                                         ,YY
                                                                        ,_T
@@ -265,10 +292,11 @@
                                                                        ,datepart(month,start) AS [month]
                                                                        ,datepart(year,start) AS [year]
                                                                   from R  )
-                                --select * from MthCal
+                               -- select * from MthCal

-                                --- Need to Pivot data to display in Horizontal way --- Need to think it to join Calendar table ( with integer t number ) rather using [201808],[201809] instead using [1],[2] to speed up exe
-
+                        ---=====================================================================================================================================
+                        --- Need to Pivot data to display in Horizontal way --- Need to think it to join Calendar table ( with integer t number ) rather using [201808],[201809] instead using [1],[2] to speed up execution t
+                        ---=====================================================================================================================================
                         ,_fcst as ( select f.ItemNumber_f,f.Description,f.d1,f.d3,f.d2,f.Value
                                                                ,c.*                                                                                                                                                           h rank/order

@@ -276,17 +304,20 @@
                                          -- where fc.ItemNumber = ('42.210.031') order by fc.ItemNumber,fc.StartDt,fc.Date
                                                )

-              --select * from fcst_  f where f.ItemNumber_f in ('18.010.035')
-
+             -- select * from _fcst  f --where f.ItemNumber_f in ('18.010.035')

+                         ---===============================================================================
                          -- Need to Join back Original to get Data for only MI Month you Need --- 3/8/2018
+                         ---===============================================================================
                        ,mi2fc_ as ( select f.ItemID,f.Date,f.ValidStatus,f.value as Value_Orig from mi2fc f)
                        ,fcst_ as ( select *
-                                           from mi2fc_ myf left join _fcst f on myf.ItemID = f.ItemNumber_f and myf.Date = f.d1
+                                           from mi2fc_ myf left join _fcst f on myf.ItemID = f.ItemNumber_f and myf.Date = f.d1                -- this is wrongas it will go back to original list which will include 'offendi
+                                                -- from  _fcst f left join mi2fc_ myf on myf.ItemID = f.ItemNumber_f and myf.Date = f.d1
                                                )
                -- select * from _fcst f where f.ItemNumber_f is null

-                               , mypvt as
+                         -- select * from fcst_ f order by f.ItemNumber_f                                      -- Testing --> this is good testing point
+                       , mypvt as
                                        ( select *
                                                 from
                                                                ( select f.ItemNumber_f,f.Description,f._T,f.Value  from fcst_ f  ) as sourcetb
@@ -298,12 +329,14 @@

                                select pv.ItemNumber_f
                                           ,pv.Description
+
                                           ,'Market Intelligence_2' as DataType
-                                          ,'TBC' as ChangeNoticeNumber
+                                          ,'TBC'                                       as ChangeNoticeNumber
                                           , 'Check_Original_Raw' as Comment
-                                          , 'TBC' as Creator
-                                          , 'TBC' as RefNum
-                                          , 'Y' as ValidStatus
+                                          , 'TBC'                               as Creator
+                                          , 'TBC'                               as RefNum
+                                          , 'Y'                                 as ValidStatus
+
                                           , getdate() as LastUpdated
                                           ,isnull(pv.[0],0) [0]
                                           ,isnull(pv.[1],0) [1]
@@ -321,4 +354,4 @@
                                 from mypvt pv
                                -- where pv.ItemNumber_f in ('18.013.089')
                                --where pv.ItemNumber_f is null
-                                order by pv.ItemNumber_f
+                                order by pv.ItemNumber_f
\ No newline at end of file
diff --git a/MI_Code.txt b/MI_Code.txt
index a37aef9..9d2ce3e 100644
--- a/MI_Code.txt
+++ b/MI_Code.txt
@@ -1,5 +1,8 @@
-       ---first sumarize PO by month ---
-                with po as (
+
+       use JDE_DB_Alan
+       go
+
+       with po as (
                                                 select tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb.TransactionOriginator,tb.TransactionOrigName,tb.SupplierName
                                                                ,sum(tb.PO_Volume) as PO_Vol
                                                        from JDE_DB_Alan.vw_OpenPO tb
@@ -9,20 +12,22 @@
                                          )
                                        --select * from po

-                                       ---  Need to aggregate FC for Single SKU ---  1/8/2018
+                                       ---====================================================
+                                       ---  Need to Aggregate FC Value for Single SKU ---  1/8/2018
+                                       ---=====================================================
                    ,mi2fc as ( select mi2.ItemID,mi2.Date,mi2.ValidStatus,sum(mi2.Value) as value
                                                                from JDE_DB_Alan.FCPRO_MI_2_Raw_Data_tmp mi2
                                                                where mi2.ValidStatus = 'Y'
                                                                --where mi2.ValidStatus = 'S'                                                           -- ' S' denotes for Simulation only   --- 2/8/2018 --- only pickup S it
o put Y instead of S
                                                                 and mi2.Value >0                                                                                       --- Need to pick up non Zero value  --3/8/2018
-                                                                  --  and mi2.ItemID in ('18.010.035')
+                                                                    --and mi2.ItemID in ('18.010.035')
                                                                group by mi2.ItemID,mi2.date,mi2.ValidStatus
                                                                )
                    -- select distinct mi2fc.ItemID from mi2fc
                                  -- FC --- updated 12/7/2018 to include MI in table variable ( Or Temp table)
                                  ,fc_mas as ( select * from JDE_DB_Alan.vw_FC f
                                                        --where f.ItemNumber in ('18.010.035','42.210.031')                     -- deliberately choose 2 items in vw_FC, 1 is 18.010.035 which also exists in MI_orig table, 1
but exists in vw_FC master table to check what result it will yield after Join --- 25/7/2018
-                                                         -- where f.ItemNumber in ('26.800.833')
+                                                        --  where f.ItemNumber in ('26.800.833','18.010.035')
                                                                -- and f.Date < '2019-03-02'                                                            -- choose small date range to return small data set for easy manupilati
                                                           )
                                  ,_fc as
@@ -37,6 +42,10 @@
                                                     from fc_mas f full outer join mi2fc f_ on f.ItemNumber = f_.ItemID and f.Date = f_.Date                                            -- 1/8/2018, Need to combine multip ent
 will have all data (includes 18.013.089) but big recordsets, because you are picking up all SKUs in 'Master' file regardless if they have forecast or not ( currently you filter out items has no sales history over last 12 m

                                                 )
                                  -- select * from _fc where _fc.ItemID in ('18.013.089')
+
+                                  ---===================================================
+                                  --- Get your Final list with Item/FC_Vol/Date etc ---
+                                  ---===================================================
                                 ,fc as
                                           ( select f.ItemID,f.myFcDate,f.myFcQty,f.ItemNumber,f.Date,f.FCDate_,f.FC_Vol
                                                                ,case when f.myFcQty is null then f.FC_Vol                                                                                              -- if Item doest not ex
@@ -67,10 +76,11 @@
                                                 )

                                  -- select distinct fc.ItemNumber from fc
-                                 --select  * from fc  where fc.ItemNumber_f in ('18.013.089')
+                                -- select  * from fc  where fc.ItemNumber_f in ('18.013.089')
                                  --select  * from fc  where fc.ItemID in ('18.013.089') or fc.ItemNumber_f in ('18.013.089')                   --- note 18.013.089 has no existence in 'FVPRO_Fcst' table as there is no sales
e you will have unexpected result - be careful here in where condition be careful to which ItemNumber or ItemId you need to use. Also be careful using 'Not In ( )' conditional because if there is null value SQL will return
-                                  --select * from fc
+                                --  select * from fc where fc.ItemNumber_f in ('709895')

+                                   --- Join PO and Item Master ---
                                        ,tb as
                                                ( select f.ItemNumber_f,f.FcDate_f,f.Date_f,f.FC_Vol_f as FC_Vol                                -- will it cause issues if you rename 'f.FC_Vol_f' as 'FC_Vol' since you alread
                                                         -- select f.ItemNumber,f.Date,f.FCDate_,f.FC_Vol_f
@@ -91,8 +101,12 @@
                                                          -- and f.ItemNumber in ('45.103.000')
                                                                         )

-                                  --select * from tb where tb.ItemNumber_f in ('18.013.089') order by tb.ItemNumber_f,tb.FCDate_f
-                                         ,tb_ as (
+                                    --select * from tb where tb.ItemNumber_f in ('18.013.089') order by tb.ItemNumber_f,tb.FCDate_f
+
+                                         ---==================================================================
+                                         --- Get your Ezi plan format( Open stock/End stock/PO/Week Cover) ---
+                                         ---==================================================================
+                                        ,tb_ as (
                                                                select tb.ItemNumber_f,tb.Date_f,tb.FCDate_f,tb.FC_Vol,tb.PO_Vol,tb.SOH_Vol
                                                                                ,case
                                                                                           when tb.Date_f >DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)  then (tb.PO_Vol -tb.FC_Vol)
@@ -155,9 +169,10 @@
                                                                                          --  end as mywholesaleprice
                                                                                --from t_ left join pri on t_.ItemNumber = pri.ItemNumber )

-                                               ---===========================================================================================================
+                                               --===================================================================================
                                                --- Filter out Item does not exist using inner join Or O/U items ( discontinued) by using stocking type filter
-                                               ---===========================================================================================================
+                                               ---===================================================================================
+
                                          ,_t as ( --select t_.ItemNumber,t_.Date,t_.FCDate_,t_.FC_Vol,t_.PO_Vol,t_.SOH_Vol,t_.SOH_Vol_,t_.Final_SOH_Begin_M_,t_.SOH_End_M_,m.WholeSalePrice     -- will spit out column by col 14/5/2018
                                                                        select t_.*
                                                                                        , mm.WholeSalePrice as Mywholesaleprice
@@ -179,18 +194,19 @@
                                                                        --from t_ left join JDE_DB_Alan.vw_Mast mm on t_.ItemNumber_f = mm.ItemNumber   )                               -- note that 'vw_Mast ' has clean data,son )  - 23/7/2018
                                                                          from t_ inner join JDE_DB_Alan.vw_Mast mm on t_.ItemNumber_f = mm.ItemNumber                                  -- Use inner join to filter out SKUs no', so SKUs against AWF will filter out ( like in CommonWealth Bank Proj - '7089895','709901' ) -- 23/7/2018
                                                                        --  where mm.StockingType not in ('O','U')                                                                                                             ' - project Comwlth Bank Project. Should keep sku has no sales history over last 12 months like '18.013.089'  in Proj RAMLER -- 7/8/2018
-                                                                       --  where mm.StockingType in ('O','K','W','X','S','F','P','U','Q','Z','C','M','0','I')
+                                                                       --  where mm.StockingType in ('O','K','W','X','S','F','P','U','Q','Z','C','M','0','I')
                                                                          where mm.StockingType in ('K','W','X','S','F','P','Q','Z','C','M','0','I') --or mm.StockingType is null                                  -- this coulSet due to Null value --- 23/7/2018
                                                                                                )

-                                               -- select * from _t
-                                               --  where _t.ItemNumber_f in ('32.501.000','709895','82.691.909','18.013.089','42.210.031')
-                                                       --where _t.ItemNumber in ('45.103.000','45.200.100','42.210.031')
+                                                --select * from _t
+                                                       --where _t.ItemNumber_f in ('32.501.000','709895','18.013.089','82.691.909','42.210.031')
+                                                       --where _t.ItemNumber_f in ('45.103.000','45.200.100','42.210.031')
                                                         -- where _t.ItemNumber in ('0751031003001H')
                                                         --order by _t.ItemNumber,_t.Date

                                                --select _t.ItemNumber_f,_t.Date_f d1,_t.FCDate_f d2,'Start_Stk' as DataType,_t.Final_SOH_Begin_M_ as value,_t.Stk_Out_Stauts,_t.Owner_,_t.PrimarySupplier,_t.Description,_t.FarNumber from _t

+                                        -- Combine all your planning data together --
                                         ,com as ( select _t.ItemNumber_f,_t.Date_f d1,_t.Date_f_2 d3,_t.FCDate_f d2,'FC_Qty' as DataType,_t.FC_Vol as Value,_t.Stk_Out_Stauts,_t.Owner_,_t.PrimarySupplier,_t.Description,_t.FerNumber from _t
                                                                   union all
                                                                   select _t.ItemNumber_f,_t.Date_f d1,_t.Date_f_2 d3,_t.FCDate_f d2,'PO_Qty' as DataType,_t.PO_Vol as value,_t.Stk_Out_Stauts,_t.Owner_,_t.PrimarySupplier,_t.ime_Mth,_t.PlannerNumber from _t
@@ -210,8 +226,14 @@
                                                                   )

                                        -- select distinct com.ItemNumber_f from com
+                               ,stg as ( select * from com where com.ItemNumber_f in ('32.501.000','709895','18.013.089','82.691.909','42.210.031') )          -- For testing purpose
+
+                                   ---======================================================
+                                   --Only Pick up Items in Markeing Intelligence File ---
+                                       ---======================================================
                                ,fcst as
-                                                (select * from com
+                                                (--select * from stg as com                                                                                                    --- For testing purpose
+                                                  select * from com
                                                         --where com.Stk_Out_Stauts in ('Y')
                                                           -- where com.ItemNumber in ('45.103.000','45.200.100')
                                                        --where com.ItemNumber in ('4152336048B')
@@ -231,12 +253,17 @@

                                                        --order by com.ItemNumber_f,com.DataType,com.d2
                                                           )
-                                         --select * from fcst where fcst.ItemNumber_f is null
+                                         --select * from fcst
+                                         -- where fcst.ItemNumber_f in ('32.501.000','709895','18.013.089','82.691.909','42.210.031')
+                                         --where fcst.ItemNumber_f is null
                                          --where fcst.ItemNumber_f in ('18.010.035')

-
-                                 --- Get Preparation to Pivot Data using SQL --- It is better to use Numbwe Array ([1],[2],[3] ) instead of ([201807],[201808],[201809]) as it is more versatile and flexible to avoid hard co
-                               ,R(N,_T,T_,T,XX,YY,start) AS
+                                ---=======================
+                                --- Transform your data ---
+                                ---=======================
+                                --- Get Preparation to Pivot Data using SQL --- It is better to use Numbwe Array ([1],[2],[3] ) instead of ([201807],[201808],[201809]) as it is more versatile and flexible to avoid hard cod
+                                --;with
+                                 ,R(N,_T,T_,T,XX,YY,start) AS
                                                (
                                                 select 1 as N,-24 as _T,24 as T_,-23 as T,24 as XX,24 as YY,cast(DATEADD(mm, DATEDIFF(mm, 0, GETDATE())-24, 0) as datetime) as start      -- pay attention T starts -23,you nent month you start as 1, otherwise you can use XX field
                                                 UNION ALL
@@ -256,7 +283,7 @@
                                        --select * from r
                                        --select R.N,case when R._T < 0 then R.T_ else R._T end as T, start from R
                                        --select R.N,case when R._T < 0 then R.T_ else R.YY end as T, start from R
-                                 ,MthCal as (
+                        ,MthCal as (
                                                                        select  n as rnk
                                                                         ,YY
                                                                        ,_T
@@ -265,10 +292,11 @@
                                                                        ,datepart(month,start) AS [month]
                                                                        ,datepart(year,start) AS [year]
                                                                   from R  )
-                                --select * from MthCal
+                               -- select * from MthCal

-                                --- Need to Pivot data to display in Horizontal way --- Need to think it to join Calendar table ( with integer t number ) rather using [201808],[201809] instead using [1],[2] to speed up exe
-
+                        ---=====================================================================================================================================
+                        --- Need to Pivot data to display in Horizontal way --- Need to think it to join Calendar table ( with integer t number ) rather using [201808],[201809] instead using [1],[2] to speed up execution t
+                        ---=====================================================================================================================================
                         ,_fcst as ( select f.ItemNumber_f,f.Description,f.d1,f.d3,f.d2,f.Value
                                                                ,c.*                                                                                                                                                           h rank/order

@@ -276,17 +304,20 @@
                                          -- where fc.ItemNumber = ('42.210.031') order by fc.ItemNumber,fc.StartDt,fc.Date
                                                )

-              --select * from fcst_  f where f.ItemNumber_f in ('18.010.035')
-
+             -- select * from _fcst  f --where f.ItemNumber_f in ('18.010.035')

+                         ---===============================================================================
                          -- Need to Join back Original to get Data for only MI Month you Need --- 3/8/2018
+                         ---===============================================================================
                        ,mi2fc_ as ( select f.ItemID,f.Date,f.ValidStatus,f.value as Value_Orig from mi2fc f)
                        ,fcst_ as ( select *
-                                           from mi2fc_ myf left join _fcst f on myf.ItemID = f.ItemNumber_f and myf.Date = f.d1
+                                           from mi2fc_ myf left join _fcst f on myf.ItemID = f.ItemNumber_f and myf.Date = f.d1                -- this is wrongas it will go back to original list which will include 'offendi
+                                                -- from  _fcst f left join mi2fc_ myf on myf.ItemID = f.ItemNumber_f and myf.Date = f.d1
                                                )
                -- select * from _fcst f where f.ItemNumber_f is null

-                               , mypvt as
+                         -- select * from fcst_ f order by f.ItemNumber_f                                      -- Testing --> this is good testing point
+                       , mypvt as
                                        ( select *
                                                 from
                                                                ( select f.ItemNumber_f,f.Description,f._T,f.Value  from fcst_ f  ) as sourcetb
@@ -298,12 +329,14 @@

                                select pv.ItemNumber_f
                                           ,pv.Description
+
                                           ,'Market Intelligence_2' as DataType
-                                          ,'TBC' as ChangeNoticeNumber
+                                          ,'TBC'                                       as ChangeNoticeNumber
                                           , 'Check_Original_Raw' as Comment
-                                          , 'TBC' as Creator
-                                          , 'TBC' as RefNum
-                                          , 'Y' as ValidStatus
+                                          , 'TBC'                               as Creator
+                                          , 'TBC'                               as RefNum
+                                          , 'Y'                                 as ValidStatus
+
                                           , getdate() as LastUpdated
                                           ,isnull(pv.[0],0) [0]
                                           ,isnull(pv.[1],0) [1]
@@ -321,4 +354,4 @@
                                 from mypvt pv
                                -- where pv.ItemNumber_f in ('18.013.089')
                                --where pv.ItemNumber_f is null
-                                order by pv.ItemNumber_f
+                                order by pv.ItemNumber_f
\ No newline at end of file
...skipping...
+                        ,MthCal as (
                                                                        select  n as rnk
                                                                         ,YY
                                                                        ,_T
@@ -265,10 +292,11 @@
                                                                        ,datepart(month,start) AS [month]
                                                                        ,datepart(year,start) AS [year]
                                                                   from R  )
-                                --select * from MthCal
+                               -- select * from MthCal

-                                --- Need to Pivot data to display in Horizontal way --- Need to think it to join Calendar table ( with integer t number ) rather using [201808],[201809] instead using [1],[2] to speed up exe
-
+                        ---=====================================================================================================================================
+                        --- Need to Pivot data to display in Horizontal way --- Need to think it to join Calendar table ( with integer t number ) rather using [201808],[201809] instead using [1],[2] to speed up execution t
+                        ---=====================================================================================================================================
                         ,_fcst as ( select f.ItemNumber_f,f.Description,f.d1,f.d3,f.d2,f.Value
                                                                ,c.*                                                                                                                                                           h rank/order

@@ -276,17 +304,20 @@
                                          -- where fc.ItemNumber = ('42.210.031') order by fc.ItemNumber,fc.StartDt,fc.Date
                                                )

-              --select * from fcst_  f where f.ItemNumber_f in ('18.010.035')
-
+             -- select * from _fcst  f --where f.ItemNumber_f in ('18.010.035')

+                         ---===============================================================================
                          -- Need to Join back Original to get Data for only MI Month you Need --- 3/8/2018
+                         ---===============================================================================
                        ,mi2fc_ as ( select f.ItemID,f.Date,f.ValidStatus,f.value as Value_Orig from mi2fc f)
                        ,fcst_ as ( select *
-                                           from mi2fc_ myf left join _fcst f on myf.ItemID = f.ItemNumber_f and myf.Date = f.d1
+                                           from mi2fc_ myf left join _fcst f on myf.ItemID = f.ItemNumber_f and myf.Date = f.d1                -- this is wrongas it will go back to original list which will include 'offendi
+                                                -- from  _fcst f left join mi2fc_ myf on myf.ItemID = f.ItemNumber_f and myf.Date = f.d1
                                                )
                -- select * from _fcst f where f.ItemNumber_f is null

-                               , mypvt as
+                         -- select * from fcst_ f order by f.ItemNumber_f                                      -- Testing --> this is good testing point
+                       , mypvt as
                                        ( select *
                                                 from
                                                                ( select f.ItemNumber_f,f.Description,f._T,f.Value  from fcst_ f  ) as sourcetb
@@ -298,12 +329,14 @@

                                select pv.ItemNumber_f
                                           ,pv.Description
+
                                           ,'Market Intelligence_2' as DataType
-                                          ,'TBC' as ChangeNoticeNumber
+                                          ,'TBC'                                       as ChangeNoticeNumber
                                           , 'Check_Original_Raw' as Comment
-                                          , 'TBC' as Creator
-                                          , 'TBC' as RefNum
-                                          , 'Y' as ValidStatus
+                                          , 'TBC'                               as Creator
+                                          , 'TBC'                               as RefNum
+                                          , 'Y'                                 as ValidStatus
+
                                           , getdate() as LastUpdated
                                           ,isnull(pv.[0],0) [0]
                                           ,isnull(pv.[1],0) [1]
@@ -321,4 +354,4 @@
                                 from mypvt pv
                                -- where pv.ItemNumber_f in ('18.013.089')
                                --where pv.ItemNumber_f is null
-                                order by pv.ItemNumber_f
+                                order by pv.ItemNumber_f
\ No newline at end of file
...skipping...
-                                 ,MthCal as (
+                        ,MthCal as (
                                                                        select  n as rnk
                                                                         ,YY
                                                                        ,_T
@@ -265,10 +292,11 @@
                                                                        ,datepart(month,start) AS [month]
                                                                        ,datepart(year,start) AS [year]
                                                                   from R  )
-                                --select * from MthCal
+                               -- select * from MthCal

-                                --- Need to Pivot data to display in Horizontal way --- Need to think it to join Calendar table ( with integer t number ) rather using [201808],[201809] instead using [1],[2] to speed up exe
-
+                        ---=====================================================================================================================================
+                        --- Need to Pivot data to display in Horizontal way --- Need to think it to join Calendar table ( with integer t number ) rather using [201808],[201809] instead using [1],[2] to speed up execution t
+                        ---=====================================================================================================================================
                         ,_fcst as ( select f.ItemNumber_f,f.Description,f.d1,f.d3,f.d2,f.Value
                                                                ,c.*                                                                                                                                                           h rank/order

@@ -276,17 +304,20 @@
                                          -- where fc.ItemNumber = ('42.210.031') order by fc.ItemNumber,fc.StartDt,fc.Date
                                                )

-              --select * from fcst_  f where f.ItemNumber_f in ('18.010.035')
-
+             -- select * from _fcst  f --where f.ItemNumber_f in ('18.010.035')

+                         ---===============================================================================
                          -- Need to Join back Original to get Data for only MI Month you Need --- 3/8/2018
+                         ---===============================================================================
                        ,mi2fc_ as ( select f.ItemID,f.Date,f.ValidStatus,f.value as Value_Orig from mi2fc f)
                        ,fcst_ as ( select *
-                                           from mi2fc_ myf left join _fcst f on myf.ItemID = f.ItemNumber_f and myf.Date = f.d1
+                                           from mi2fc_ myf left join _fcst f on myf.ItemID = f.ItemNumber_f and myf.Date = f.d1                -- this is wrongas it will go back to original list which will include 'offendi
+                                                -- from  _fcst f left join mi2fc_ myf on myf.ItemID = f.ItemNumber_f and myf.Date = f.d1
                                                )
                -- select * from _fcst f where f.ItemNumber_f is null

-                               , mypvt as
+                         -- select * from fcst_ f order by f.ItemNumber_f                                      -- Testing --> this is good testing point
+                       , mypvt as
                                        ( select *
                                                 from
                                                                ( select f.ItemNumber_f,f.Description,f._T,f.Value  from fcst_ f  ) as sourcetb
@@ -298,12 +329,14 @@

                                select pv.ItemNumber_f
                                           ,pv.Description
+
                                           ,'Market Intelligence_2' as DataType
-                                          ,'TBC' as ChangeNoticeNumber
+                                          ,'TBC'                                       as ChangeNoticeNumber
                                           , 'Check_Original_Raw' as Comment
-                                          , 'TBC' as Creator
-                                          , 'TBC' as RefNum
-                                          , 'Y' as ValidStatus
+                                          , 'TBC'                               as Creator
+                                          , 'TBC'                               as RefNum
+                                          , 'Y'                                 as ValidStatus
+
                                           , getdate() as LastUpdated
                                           ,isnull(pv.[0],0) [0]
                                           ,isnull(pv.[1],0) [1]
@@ -321,4 +354,4 @@
                                 from mypvt pv
                                -- where pv.ItemNumber_f in ('18.013.089')
                                --where pv.ItemNumber_f is null
-                                order by pv.ItemNumber_f
+                                order by pv.ItemNumber_f
\ No newline at end of file

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git status
On branch master
Your branch is up to date with 'origin/master'.

Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

        modified:   MI_Code.txt

Untracked files:
  (use "git add <file>..." to include in what will be committed)

        MI_Sim_Code.txt

no changes added to commit (use "git add" and/or "git commit -a")

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git add .

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git status
On branch master
Your branch is up to date with 'origin/master'.

Changes to be committed:
  (use "git reset HEAD <file>..." to unstage)

        modified:   MI_Code.txt
        new file:   MI_Sim_Code.txt


yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git commit -m "add MI_Simulation_Code.txt"
[master 4341932] add MI_Simulation_Code.txt
 Committer: alanyaoy <yaoa@hunterdouglas.com.au>
Your name and email address were configured automatically based
on your username and hostname. Please check that they are accurate.
You can suppress this message by setting them explicitly:

    git config --global user.name "Your Name"
    git config --global user.email you@example.com

After doing this, you may fix the identity used for this commit with:

    git commit --amend --reset-author

 2 files changed, 392 insertions(+), 33 deletions(-)
 create mode 100644 MI_Sim_Code.txt

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ push
bash: push: command not found

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git push
Enumerating objects: 6, done.
Counting objects: 100% (6/6), done.
Delta compression using up to 4 threads.
Compressing objects: 100% (4/4), done.
Writing objects: 100% (4/4), 7.33 KiB | 3.67 MiB/s, done.
Total 4 (delta 2), reused 0 (delta 0)
remote: Resolving deltas: 100% (2/2), completed with 2 local objects.
To https://github.com/alanyaoy/VBA.git
   7f78b9e..4341932  master -> master

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git status
On branch master
Your branch is up to date with 'origin/master'.

Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

        modified:   MI_Sim_Code.txt

no changes added to commit (use "git add" and/or "git commit -a")

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git diff
diff --git a/MI_Sim_Code.txt b/MI_Sim_Code.txt
index 8c25304..ed62126 100644
--- a/MI_Sim_Code.txt
+++ b/MI_Sim_Code.txt
@@ -1,23 +1,33 @@
- with po as (
+       use JDE_DB_Alan
+       go
+SQLQuery_HD_sp_MI_Raw_2_Combine_Mismatch_Old.sql
+
+        --- Old MI Code --> [JDE_DB_Alan].[sp_MI_2_Raw_Combine_Mismatch] --- 3/8/2018 ---
+       ---first sumarize PO by month ---
+                with po as (
                                                 select tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb.TransactionOriginator,tb.TransactionOrigName,tb.SupplierName
                                                                ,sum(tb.PO_Volume) as PO_Vol
                                                        from JDE_DB_Alan.vw_OpenPO tb
                                                 -- where tb.ItemNumber in  ( select splitdata from JDE_DB_Alan.dbo.fnSplitString(@Item_id,','))
                                                  group by tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb.TransactionOriginator,tb.TransactionOrigName,tb.SupplierName

-                                                 )
+                                         )
                                        --select * from po

                                        ---  Need to aggregate FC for Single SKU ---  1/8/2018
                    ,mi2fc as ( select mi2.ItemID,mi2.Date,mi2.ValidStatus,sum(mi2.Value) as value
                                                                from JDE_DB_Alan.FCPRO_MI_2_Raw_Data_tmp mi2
-                                                               where mi2.ValidStatus = 'S'                                                             -- ' S' denotes for Simulation only   --- 2/8/2018 --- only pickup S ito put Y instead of Y
-                                                                    and mi2.Value >0                                                                                   --- Need to pick up non Zero value  --3/8/2018
+                                                               where mi2.ValidStatus = 'Y'
+                                                               --where mi2.ValidStatus = 'S'                                                           -- ' S' denotes for Simulation only   --- 2/8/2018 --- only pickup S ito put Y instead of S
+                                                                and mi2.Value >0                                                                                       --- Need to pick up non Zero value  --3/8/2018
+                                                                  --  and mi2.ItemID in ('18.010.035')
                                                                group by mi2.ItemID,mi2.date,mi2.ValidStatus
                                                                )
+                   -- select distinct mi2fc.ItemID from mi2fc
                                  -- FC --- updated 12/7/2018 to include MI in table variable ( Or Temp table)
                                  ,fc_mas as ( select * from JDE_DB_Alan.vw_FC f
                                                        --where f.ItemNumber in ('18.010.035','42.210.031')                     -- deliberately choose 2 items in vw_FC, 1 is 18.010.035 which also exists in MI_orig table, 1 but exists in vw_FC master table to check what result it will yield after Join --- 25/7/2018
+                                                         -- where f.ItemNumber in ('26.800.833')
                                                                -- and f.Date < '2019-03-02'                                                            -- choose small date range to return small data set for easy manupilati
                                                           )
                                  ,_fc as
@@ -31,7 +41,7 @@
                                                   --from fc_mas f full outer join JDE_DB_Alan.FCPRO_MI_2_Raw_Data_tmp f_ on f.ItemNumber = f_.ItemID and f.Date = f_.Date              -- 31/7/2018, change table name -- use t big recordsets, because you are picking up all SKUs in 'Master' file regardless if they have forecast or not ( currently you filter out items has no sales history over last 12 months and prevent them generating fc )
                                                     from fc_mas f full outer join mi2fc f_ on f.ItemNumber = f_.ItemID and f.Date = f_.Date                                            -- 1/8/2018, Need to combine multip ent will have all data (includes 18.013.089) but big recordsets, because you are picking up all SKUs in 'Master' file regardless if they have forecast or not ( currently you filter out items has no sales history over last 12 m

                                                 )
-                                --  select * from _fc
+                                 -- select * from _fc where _fc.ItemID in ('18.013.089')
                                 ,fc as
                                           ( select f.ItemID,f.myFcDate,f.myFcQty,f.ItemNumber,f.Date,f.FCDate_,f.FC_Vol
                                                                ,case when f.myFcQty is null then f.FC_Vol                                                                                              -- if Item doest not ex
@@ -57,12 +67,14 @@
                                                --  from  @mymi f_  left join JDE_DB_Alan.vw_FC f on f.ItemNumber = f_.ItemID and f.FCDate_ = f_.FcDate_Raw                     --- not good causing big problems for SOH etc b month, say if MI is for 2018-09 then you will not get SOH ( since SOH is always default to current month you are in ) and you need visibility for each month, YOU can use left join if you are not concerning SOH figure but i keep use full outer join and filter out on specific SKUs at end,this might best solution for this issue 25/7/2018 --- Will Use this lead to risk of lossing item has no sales history 18.013.089 --- No ???
                                                -- where f.ItemNumber in ( '42.210.031','24.7207.4459')
                                                         --  and f.Date < '2019-03-01'
-                                                --where f.ItemNumber in ('18.010.035')
+                                               -- where f.ItemNumber in ('18.010.035')
+                                                --where f.ItemID in ('18.013.089')
                                                 )

                                  -- select distinct fc.ItemNumber from fc
-                                 --select  * from fc  where fc.ItemID in ('18.013.089') or fc.ItemNumber in ('18.013.089')                     --- note 18.013.089 has no existence in 'FVPRO_Fcst' table as there is no salese you will have unexpected result - be careful here in where condition be careful to which ItemNumber or ItemId you need to use. Also be careful using 'Not In ( )' conditional because if there is null value SQL will return
:
diff --git a/MI_Sim_Code.txt b/MI_Sim_Code.txt
index 8c25304..ed62126 100644
--- a/MI_Sim_Code.txt
+++ b/MI_Sim_Code.txt
@@ -1,23 +1,33 @@
- with po as (
+       use JDE_DB_Alan
+       go
+SQLQuery_HD_sp_MI_Raw_2_Combine_Mismatch_Old.sql
+
+        --- Old MI Code --> [JDE_DB_Alan].[sp_MI_2_Raw_Combine_Mismatch] --- 3/8/2018 ---
+       ---first sumarize PO by month ---
+                with po as (
                                                 select tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb.Trans                                                                            actionOriginator,tb.TransactionOrigName,tb.SupplierName
                                                                ,sum(tb.PO_Volume) as PO_Vol
                                                        from JDE_DB_Alan.vw_OpenPO tb
                                                 -- where tb.ItemNumber in  ( select splitdata from JDE_DB_Alan.dbo.fnSplitString(@Item_id,','))

                                                  group by tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb.Tr                                                                            ansactionOriginator,tb.TransactionOrigName,tb.SupplierName

-                                                 )
+                                         )
                                        --select * from po

                                        ---  Need to aggregate FC for Single SKU ---  1/8/2018
                    ,mi2fc as ( select mi2.ItemID,mi2.Date,mi2.ValidStatus,sum(mi2.Value) as value
                                                                from JDE_DB_Alan.FCPRO_MI_2_Raw_Data_tmp mi2
-                                                               where mi2.ValidStatus = 'S'
        -- ' S' denotes for Simulation only   --- 2/8/2018 --- only pickup S items for Simulation, when MI confirmed you need to put Y instead of Y
-                                                                    and mi2.Value >0
                        --- Need to pick up non Zero value  --3/8/2018
+                                                               where mi2.ValidStatus = 'Y'
:
diff --git a/MI_Sim_Code.txt b/MI_Sim_Code.txt
index 8c25304..ed62126 100644
--- a/MI_Sim_Code.txt
+++ b/MI_Sim_Code.txt
@@ -1,23 +1,33 @@
- with po as (
+       use JDE_DB_Alan
+       go
+SQLQuery_HD_sp_MI_Raw_2_Combine_Mismatch_Old.sql
+
+        --- Old MI Code --> [JDE_DB_Alan].[sp_MI_2_Raw_Combine_Mismatch] --- 3/8/2018 ---
+       ---first sumarize PO by month ---
+                with po as (
                                                 select tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.p                                                                                                                     omth,tb.BuyerName,tb.BuyerNumber,tb.TransactionOriginator,tb.TransactionOrigName,tb.SupplierName
                                                                ,sum(tb.PO_Volume) as PO_Vol
                                                        from JDE_DB_Alan.vw_OpenPO tb
                                                 -- where tb.ItemNumber in  ( select splitdata from JDE_DB                                                                                                                     _Alan.dbo.fnSplitString(@Item_id,','))
                                                  group by tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,t                                                                                                                     b.pomth,tb.BuyerName,tb.BuyerNumber,tb.TransactionOriginator,tb.TransactionOrigName,tb.SupplierName

-                                                 )
+                                         )
                                        --select * from po

                                        ---  Need to aggregate FC for Single SKU ---  1/8/2018
                    ,mi2fc as ( select mi2.ItemID,mi2.Date,mi2.ValidStatus,sum(mi2.Value) as value
                                                                from JDE_DB_Alan.FCPRO_MI_2_Raw_Data_tmp m                                                                                                                     i2
-                                                               where mi2.ValidStatus = 'S'
                                                -- ' S' denotes for Simulation only   --- 2/8/2018 --- onl                                                                                                                     y pickup S items for Simulation, when MI confirmed you need to put Y instead of Y
-                                                                    and mi2.Value >0
:
diff --git a/MI_Sim_Code.txt b/MI_Sim_Code.txt
index 8c25304..ed62126 100644
--- a/MI_Sim_Code.txt
+++ b/MI_Sim_Code.txt
@@ -1,23 +1,33 @@
- with po as (
+       use JDE_DB_Alan
+       go
+SQLQuery_HD_sp_MI_Raw_2_Combine_Mismatch_Old.sql
+
+        --- Old MI Code --> [JDE_DB_Alan].[sp_MI_2_Raw_Combine_Mismatch] --- 3/8/2018 ---
+       ---first sumarize PO by month ---
+                with po as (
                                                 select tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb.Tr                                                                               ansactionOriginator,tb.TransactionOrigName,tb.SupplierName
                                                                ,sum(tb.PO_Volume) as PO_Vol
                                                        from JDE_DB_Alan.vw_OpenPO tb
                                                 -- where tb.ItemNumber in  ( select splitdata from JDE_DB_Alan.dbo.fnSplitString(@Item_id,','))

                                                  group by tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb                                                                               .TransactionOriginator,tb.TransactionOrigName,tb.SupplierName

-                                                 )
+                                         )
                                        --select * from po

                                        ---  Need to aggregate FC for Single SKU ---  1/8/2018
                    ,mi2fc as ( select mi2.ItemID,mi2.Date,mi2.ValidStatus,sum(mi2.Value) as value
                                                                from JDE_DB_Alan.FCPRO_MI_2_Raw_Data_tmp mi2
-                                                               where mi2.ValidStatus = 'S'
        -- ' S' denotes for Simulation only   --- 2/8/2018 --- only pickup S items for Simulation, when MI confirmed you need to put Y instead o                                                                               f Y
-                                                                    and mi2.Value >0
                        --- Need to pick up non Zero value  --3/8/2018
+                                                               where mi2.ValidStatus = 'Y'
+                                                               --where mi2.ValidStatus = 'S'
        -- ' S' denotes for Simulation only   --- 2/8/2018 --- only pickup S items for Simulation, when MI confirmed you need to put Y instead o                                                                               f S
+                                                                and mi2.Value >0
                        --- Need to pick up non Zero value  --3/8/2018
+                                                                  --  and mi2.ItemID in ('18.010.035')
                                                                group by mi2.ItemID,mi2.date,mi2.ValidStatus
                                                                )
+                   -- select distinct mi2fc.ItemID from mi2fc
                                  -- FC --- updated 12/7/2018 to include MI in table variable ( Or Temp table)
                                  ,fc_mas as ( select * from JDE_DB_Alan.vw_FC f
                                                        --where f.ItemNumber in ('18.010.035','42.210.031')                     -- deliberately                                                                                choose 2 items in vw_FC, 1 is 18.010.035 which also exists in MI_orig table, 1 is 42.210.031 which does exist in Mi_orig table but exists in vw_                                                                               FC master table to check what result it will yield after Join --- 25/7/2018
+                                                         -- where f.ItemNumber in ('26.800.833')
                                                                -- and f.Date < '2019-03-02'
        -- choose small date range to return small data set for easy manupilation
                                                           )
                                  ,_fc as

:
diff --git a/MI_Sim_Code.txt b/MI_Sim_Code.txt
index 8c25304..ed62126 100644
--- a/MI_Sim_Code.txt
+++ b/MI_Sim_Code.txt
@@ -1,23 +1,33 @@
- with po as (
+       use JDE_DB_Alan
+       go
+SQLQuery_HD_sp_MI_Raw_2_Combine_Mismatch_Old.sql
+
+        --- Old MI Code --> [JDE_DB_Alan].[sp_MI_2_Raw_Combine_Mismatch] --- 3/8/2018 ---
+       ---first sumarize PO by month ---
+                with po as (
                                                 select tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb.Tr                                                                               ansactionOriginator,tb.TransactionOrigName,tb.SupplierName
                                                                ,sum(tb.PO_Volume) as PO_Vol
                                                        from JDE_DB_Alan.vw_OpenPO tb
                                                 -- where tb.ItemNumber in  ( select splitdata from JDE_DB_Alan.dbo.fnSplitString(@Item_id,','))                                                                               
                                                  group by tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb                                                                               .TransactionOriginator,tb.TransactionOrigName,tb.SupplierName

-                                                 )
+                                         )
                                        --select * from po

                                        ---  Need to aggregate FC for Single SKU ---  1/8/2018
                    ,mi2fc as ( select mi2.ItemID,mi2.Date,mi2.ValidStatus,sum(mi2.Value) as value
                                                                from JDE_DB_Alan.FCPRO_MI_2_Raw_Data_tmp mi2
-                                                               where mi2.ValidStatus = 'S'                                                                                                                                            -- ' S' denotes for Simulation only   --- 2/8/2018 --- only pickup S items for Simulation, when MI confirmed you need to put Y instead o                                                                               f Y
-                                                                    and mi2.Value >0                                                                                                                                                                  --- Need to pick up non Zero value  --3/8/2018
+                                                               where mi2.ValidStatus = 'Y'
+                                                               --where mi2.ValidStatus = 'S'                                                                                                                                          -- ' S' denotes for Simulation only   --- 2/8/2018 --- only pickup S items for Simulation, when MI confirmed you need to put Y instead o                                                                               f S
+                                                                and mi2.Value >0                                                                                                                                                                      --- Need to pick up non Zero value  --3/8/2018
+                                                                  --  and mi2.ItemID in ('18.010.035')
                                                                group by mi2.ItemID,mi2.date,mi2.ValidStatus
                                                                )
+                   -- select distinct mi2fc.ItemID from mi2fc
                                  -- FC --- updated 12/7/2018 to include MI in table variable ( Or Temp table)
                                  ,fc_mas as ( select * from JDE_DB_Alan.vw_FC f
                                                        --where f.ItemNumber in ('18.010.035','42.210.031')                     -- deliberately                                                                                choose 2 items in vw_FC, 1 is 18.010.035 which also exists in MI_orig table, 1 is 42.210.031 which does exist in Mi_orig table but exists in vw_                                                                               FC master table to check what result it will yield after Join --- 25/7/2018
+                                                         -- where f.ItemNumber in ('26.800.833')
                                                                -- and f.Date < '2019-03-02'                                                                                                                                           -- choose small date range to return small data set for easy manupilation
                                                           )
                                  ,_fc as                                                                                                                                                                                      
@@ -31,7 +41,7 @@
                                                   --from fc_mas f full outer join JDE_DB_Alan.FCPRO_MI_2_Raw_Data_tmp f_ on f.ItemNumber = f_.I                                                                               temID and f.Date = f_.Date              -- 31/7/2018, change table name -- use this will have all data (includes 18.013.089) but big recordsets,                                                                                because you are picking up all SKUs in 'Master' file regardless if they have forecast or not ( currently you filter out items has no sales hist                                                                               ory over last 12 months and prevent them generating fc )        --- ?
                                                     from fc_mas f full outer join mi2fc f_ on f.ItemNumber = f_.ItemID and f.Date = f_.Date                                                                                                                           -- 1/8/2018, Need to combine multip entry for 1 SKU; Also change table name -- use this will have all da                                                                               ta (includes 18.013.089) but big recordsets, because you are picking up all SKUs in 'Master' file regardless if they have forecast or not ( curr                                                                               ently you filter out items has no sales history over last 12 months and prevent them generating fc )    --- ?
                                                 )
-                                --  select * from _fc
+                                 -- select * from _fc where _fc.ItemID in ('18.013.089')
                                 ,fc as                                                                                                                                                                                        
                                           ( select f.ItemID,f.myFcDate,f.myFcQty,f.ItemNumber,f.Date,f.FCDate_,f.FC_Vol
:
diff --git a/MI_Sim_Code.txt b/MI_Sim_Code.txt
index 8c25304..ed62126 100644
--- a/MI_Sim_Code.txt
+++ b/MI_Sim_Code.txt
@@ -1,23 +1,33 @@
- with po as (
+       use JDE_DB_Alan
+       go
+SQLQuery_HD_sp_MI_Raw_2_Combine_Mismatch_Old.sql
+
+        --- Old MI Code --> [JDE_DB_Alan].[sp_MI_2_Raw_Combine_Mismatch] --- 3/8/2018 ---
+       ---first sumarize PO by month ---
+                with po as (
                                                 select tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb.TransactionOrigin                                                                ator,tb.TransactionOrigName,tb.SupplierName
                                                                ,sum(tb.PO_Volume) as PO_Vol
                                                        from JDE_DB_Alan.vw_OpenPO tb
                                                 -- where tb.ItemNumber in  ( select splitdata from JDE_DB_Alan.dbo.fnSplitString(@Item_id,','))
                                                  group by tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb.TransactionOri                                                                ginator,tb.TransactionOrigName,tb.SupplierName

-                                                 )
+                                         )
                                        --select * from po

                                        ---  Need to aggregate FC for Single SKU ---  1/8/2018
                    ,mi2fc as ( select mi2.ItemID,mi2.Date,mi2.ValidStatus,sum(mi2.Value) as value
                                                                from JDE_DB_Alan.FCPRO_MI_2_Raw_Data_tmp mi2
-                                                               where mi2.ValidStatus = 'S'                                                             -- ' S'                                                                 denotes for Simulation only   --- 2/8/2018 --- only pickup S items for Simulation, when MI confirmed you need to put Y instead of Y
-                                                                    and mi2.Value >0
                --- Need to pick up non Zero value  --3/8/2018
+                                                               where mi2.ValidStatus = 'Y'
+                                                               --where mi2.ValidStatus = 'S'                                                           -- ' S'                                                                 denotes for Simulation only   --- 2/8/2018 --- only pickup S items for Simulation, when MI confirmed you need to put Y instead of S
+                                                                and mi2.Value >0
                --- Need to pick up non Zero value  --3/8/2018
+                                                                  --  and mi2.ItemID in ('18.010.035')
                                                                group by mi2.ItemID,mi2.date,mi2.ValidStatus
                                                                )
+                   -- select distinct mi2fc.ItemID from mi2fc
                                  -- FC --- updated 12/7/2018 to include MI in table variable ( Or Temp table)
                                  ,fc_mas as ( select * from JDE_DB_Alan.vw_FC f
                                                        --where f.ItemNumber in ('18.010.035','42.210.031')                     -- deliberately choose 2 items                                                                 in vw_FC, 1 is 18.010.035 which also exists in MI_orig table, 1 is 42.210.031 which does exist in Mi_orig table but exists in vw_FC master table to check what                                                                 result it will yield after Join --- 25/7/2018
+                                                         -- where f.ItemNumber in ('26.800.833')
                                                                -- and f.Date < '2019-03-02'                                                            -- choo                                                                se small date range to return small data set for easy manupilation
                                                           )
                                  ,_fc as

@@ -31,7 +41,7 @@
                                                   --from fc_mas f full outer join JDE_DB_Alan.FCPRO_MI_2_Raw_Data_tmp f_ on f.ItemNumber = f_.ItemID and f.Dat                                                                e = f_.Date              -- 31/7/2018, change table name -- use this will have all data (includes 18.013.089) but big recordsets, because you are picking up al                                                                l SKUs in 'Master' file regardless if they have forecast or not ( currently you filter out items has no sales history over last 12 months and prevent them gene                                                                rating fc )        --- ?
                                                     from fc_mas f full outer join mi2fc f_ on f.ItemNumber = f_.ItemID and f.Date = f_.Date
                                -- 1/8/2018, Need to combine multip entry for 1 SKU; Also change table name -- use this will have all data (includes 18.013.089                                                                ) but big recordsets, because you are picking up all SKUs in 'Master' file regardless if they have forecast or not ( currently you filter out items has no sale                                                                s history over last 12 months and prevent them generating fc )    --- ?
                                                 )
-                                --  select * from _fc
+                                 -- select * from _fc where _fc.ItemID in ('18.013.089')
                                 ,fc as

                                           ( select f.ItemID,f.myFcDate,f.myFcQty,f.ItemNumber,f.Date,f.FCDate_,f.FC_Vol
                                                                ,case when f.myFcQty is null then f.FC_Vol
                                                -- if Item doest not exists in MI raw but exists in vw_FC master
@@ -57,12 +67,14 @@
:
diff --git a/MI_Sim_Code.txt b/MI_Sim_Code.txt
index 8c25304..ed62126 100644
--- a/MI_Sim_Code.txt
+++ b/MI_Sim_Code.txt
@@ -1,23 +1,33 @@
- with po as (
+       use JDE_DB_Alan
+       go
+SQLQuery_HD_sp_MI_Raw_2_Combine_Mismatch_Old.sql
+
+        --- Old MI Code --> [JDE_DB_Alan].[sp_MI_2_Raw_Combine_Mismatch] --- 3/8/2018 ---
+       ---first sumarize PO by month ---
+                with po as (
                                                 select tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb.TransactionOriginator,tb.TransactionOr                                           igName,tb.SupplierName
                                                                ,sum(tb.PO_Volume) as PO_Vol
                                                        from JDE_DB_Alan.vw_OpenPO tb
                                                 -- where tb.ItemNumber in  ( select splitdata from JDE_DB_Alan.dbo.fnSplitString(@Item_id,','))
                                                  group by tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb.TransactionOriginator,tb.Transactio                                           nOrigName,tb.SupplierName

-                                                 )
+                                         )
                                        --select * from po

                                        ---  Need to aggregate FC for Single SKU ---  1/8/2018
                    ,mi2fc as ( select mi2.ItemID,mi2.Date,mi2.ValidStatus,sum(mi2.Value) as value
                                                                from JDE_DB_Alan.FCPRO_MI_2_Raw_Data_tmp mi2
-                                                               where mi2.ValidStatus = 'S'                                                             -- ' S' denotes for Simulati                                           on only   --- 2/8/2018 --- only pickup S items for Simulation, when MI confirmed you need to put Y instead of Y
-                                                                    and mi2.Value >0                                                                                   --- Need to                                            pick up non Zero value  --3/8/2018
+                                                               where mi2.ValidStatus = 'Y'
+                                                               --where mi2.ValidStatus = 'S'                                                           -- ' S' denotes for Simulati                                           on only   --- 2/8/2018 --- only pickup S items for Simulation, when MI confirmed you need to put Y instead of S
+                                                                and mi2.Value >0                                                                                       --- Need to                                            pick up non Zero value  --3/8/2018
+                                                                  --  and mi2.ItemID in ('18.010.035')
                                                                group by mi2.ItemID,mi2.date,mi2.ValidStatus
                                                                )
+                   -- select distinct mi2fc.ItemID from mi2fc
                                  -- FC --- updated 12/7/2018 to include MI in table variable ( Or Temp table)
                                  ,fc_mas as ( select * from JDE_DB_Alan.vw_FC f
                                                        --where f.ItemNumber in ('18.010.035','42.210.031')                     -- deliberately choose 2 items in vw_FC, 1 is 18.010                                           .035 which also exists in MI_orig table, 1 is 42.210.031 which does exist in Mi_orig table but exists in vw_FC master table to check what result it will yield after Join --- 25/7/2                                           018
+                                                         -- where f.ItemNumber in ('26.800.833')
                                                                -- and f.Date < '2019-03-02'                                                            -- choose small date range t                                           o return small data set for easy manupilation
                                                           )
                                  ,_fc as

@@ -31,7 +41,7 @@
                                                   --from fc_mas f full outer join JDE_DB_Alan.FCPRO_MI_2_Raw_Data_tmp f_ on f.ItemNumber = f_.ItemID and f.Date = f_.Date
        -- 31/7/2018, change table name -- use this will have all data (includes 18.013.089) but big recordsets, because you are picking up all SKUs in 'Master' file regardless if                                            they have forecast or not ( currently you filter out items has no sales history over last 12 months and prevent them generating fc )        --- ?
                                                     from fc_mas f full outer join mi2fc f_ on f.ItemNumber = f_.ItemID and f.Date = f_.Date
        -- 1/8/2018, Need to combine multip entry for 1 SKU; Also change table name -- use this will have all data (includes 18.013.089) but big recordsets, because you are picking                                            up all SKUs in 'Master' file regardless if they have forecast or not ( currently you filter out items has no sales history over last 12 months and prevent them generating fc )                                               --- ?
                                                 )
-                                --  select * from _fc
+                                 -- select * from _fc where _fc.ItemID in ('18.013.089')
                                 ,fc as
                                           ( select f.ItemID,f.myFcDate,f.myFcQty,f.ItemNumber,f.Date,f.FCDate_,f.FC_Vol
                                                                ,case when f.myFcQty is null then f.FC_Vol
                        -- if Item doest not exists in MI raw but exists in vw_FC master
@@ -57,12 +67,14 @@
                                                --  from  @mymi f_  left join JDE_DB_Alan.vw_FC f on f.ItemNumber = f_.ItemID and f.FCDate_ = f_.FcDate_Raw                     ---                                            not good causing big problems for SOH etc because on Mi raw table you only have 1 or 2 or 3 month, say if MI is for 2018-09 then you will not get SOH ( since SOH is always default                                            :
diff --git a/MI_Sim_Code.txt b/MI_Sim_Code.txt
index 8c25304..ed62126 100644
--- a/MI_Sim_Code.txt
+++ b/MI_Sim_Code.txt
@@ -1,23 +1,33 @@
- with po as (
+       use JDE_DB_Alan
+       go
+SQLQuery_HD_sp_MI_Raw_2_Combine_Mismatch_Old.sql
+
+        --- Old MI Code --> [JDE_DB_Alan].[sp_MI_2_Raw_Combine_Mismatch] --- 3/8/2018 ---
+       ---first sumarize PO by month ---
+                with po as (
                                                 select tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb.TransactionOriginator,tb.TransactionOrigName                                     ,tb.SupplierName
                                                                ,sum(tb.PO_Volume) as PO_Vol
                                                        from JDE_DB_Alan.vw_OpenPO tb
                                                 -- where tb.ItemNumber in  ( select splitdata from JDE_DB_Alan.dbo.fnSplitString(@Item_id,','))
                                                  group by tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb.TransactionOriginator,tb.TransactionOrigN                                     ame,tb.SupplierName

-                                                 )
+                                         )
                                        --select * from po

                                        ---  Need to aggregate FC for Single SKU ---  1/8/2018
                    ,mi2fc as ( select mi2.ItemID,mi2.Date,mi2.ValidStatus,sum(mi2.Value) as value
                                                                from JDE_DB_Alan.FCPRO_MI_2_Raw_Data_tmp mi2
-                                                               where mi2.ValidStatus = 'S'                                                             -- ' S' denotes for Simulation onl                                     y   --- 2/8/2018 --- only pickup S items for Simulation, when MI confirmed you need to put Y instead of Y
-                                                                    and mi2.Value >0                                                                                   --- Need to pick u                                     p non Zero value  --3/8/2018
+                                                               where mi2.ValidStatus = 'Y'
+                                                               --where mi2.ValidStatus = 'S'                                                           -- ' S' denotes for Simulation onl                                     y   --- 2/8/2018 --- only pickup S items for Simulation, when MI confirmed you need to put Y instead of S
+                                                                and mi2.Value >0                                                                                       --- Need to pick u                                     p non Zero value  --3/8/2018
+                                                                  --  and mi2.ItemID in ('18.010.035')
                                                                group by mi2.ItemID,mi2.date,mi2.ValidStatus
                                                                )
+                   -- select distinct mi2fc.ItemID from mi2fc
                                  -- FC --- updated 12/7/2018 to include MI in table variable ( Or Temp table)
                                  ,fc_mas as ( select * from JDE_DB_Alan.vw_FC f
                                                        --where f.ItemNumber in ('18.010.035','42.210.031')                     -- deliberately choose 2 items in vw_FC, 1 is 18.010.035 w                                     hich also exists in MI_orig table, 1 is 42.210.031 which does exist in Mi_orig table but exists in vw_FC master table to check what result it will yield after Join --- 25/7/2018
+                                                         -- where f.ItemNumber in ('26.800.833')
                                                                -- and f.Date < '2019-03-02'                                                            -- choose small date range to retu                                     rn small data set for easy manupilation
                                                           )
                                  ,_fc as
@@ -31,7 +41,7 @@
                                                   --from fc_mas f full outer join JDE_DB_Alan.FCPRO_MI_2_Raw_Data_tmp f_ on f.ItemNumber = f_.ItemID and f.Date = f_.Date              --                                      31/7/2018, change table name -- use this will have all data (includes 18.013.089) but big recordsets, because you are picking up all SKUs in 'Master' file regardless if they have foreca                                     st or not ( currently you filter out items has no sales history over last 12 months and prevent them generating fc )        --- ?
                                                     from fc_mas f full outer join mi2fc f_ on f.ItemNumber = f_.ItemID and f.Date = f_.Date                                            --                                      1/8/2018, Need to combine multip entry for 1 SKU; Also change table name -- use this will have all data (includes 18.013.089) but big recordsets, because you are picking up all SKUs in                                      'Master' file regardless if they have forecast or not ( currently you filter out items has no sales history over last 12 months and prevent them generating fc )    --- ?

                                                 )
-                                --  select * from _fc
+                                 -- select * from _fc where _fc.ItemID in ('18.013.089')
                                 ,fc as
                                           ( select f.ItemID,f.myFcDate,f.myFcQty,f.ItemNumber,f.Date,f.FCDate_,f.FC_Vol
                                                                ,case when f.myFcQty is null then f.FC_Vol
                -- if Item doest not exists in MI raw but exists in vw_FC master
@@ -57,12 +67,14 @@
                                                --  from  @mymi f_  left join JDE_DB_Alan.vw_FC f on f.ItemNumber = f_.ItemID and f.FCDate_ = f_.FcDate_Raw                     --- not go                                     od causing big problems for SOH etc because on Mi raw table you only have 1 or 2 or 3 month, say if MI is for 2018-09 then you will not get SOH ( since SOH is always default to current m                                     onth you are in ) and you need visibility for each month, YOU can use left join if you are not concerning SOH figure but in order to keep your code consistent, you should keep use full o                                     uter join and filter out on specific SKUs at end,this might best solution for this issue 25/7/2018 --- Will Use this lead to risk of lossing item has no sales history 18.013.089 --- No ?                                     :
diff --git a/MI_Sim_Code.txt b/MI_Sim_Code.txt
index 8c25304..ed62126 100644
--- a/MI_Sim_Code.txt
+++ b/MI_Sim_Code.txt
@@ -1,23 +1,33 @@
- with po as (
+       use JDE_DB_Alan
+       go
+SQLQuery_HD_sp_MI_Raw_2_Combine_Mismatch_Old.sql
+
+        --- Old MI Code --> [JDE_DB_Alan].[sp_MI_2_Raw_Combine_Mismatch] --- 3/8/2018 ---
+       ---first sumarize PO by month ---
+                with po as (
                                                 select tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb.TransactionOriginator                                                            ,tb.TransactionOrigName,tb.SupplierName
                                                                ,sum(tb.PO_Volume) as PO_Vol
                                                        from JDE_DB_Alan.vw_OpenPO tb
                                                 -- where tb.ItemNumber in  ( select splitdata from JDE_DB_Alan.dbo.fnSplitString(@Item_id,','))
                                                  group by tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb.TransactionOrigina                                                            tor,tb.TransactionOrigName,tb.SupplierName

-                                                 )
+                                         )
                                        --select * from po

                                        ---  Need to aggregate FC for Single SKU ---  1/8/2018
                    ,mi2fc as ( select mi2.ItemID,mi2.Date,mi2.ValidStatus,sum(mi2.Value) as value
                                                                from JDE_DB_Alan.FCPRO_MI_2_Raw_Data_tmp mi2
-                                                               where mi2.ValidStatus = 'S'                                                             -- ' S' den                                                            otes for Simulation only   --- 2/8/2018 --- only pickup S items for Simulation, when MI confirmed you need to put Y instead of Y
-                                                                    and mi2.Value >0
        --- Need to pick up non Zero value  --3/8/2018
+                                                               where mi2.ValidStatus = 'Y'
+                                                               --where mi2.ValidStatus = 'S'                                                           -- ' S' den                                                            otes for Simulation only   --- 2/8/2018 --- only pickup S items for Simulation, when MI confirmed you need to put Y instead of S
+                                                                and mi2.Value >0
        --- Need to pick up non Zero value  --3/8/2018
+                                                                  --  and mi2.ItemID in ('18.010.035')
                                                                group by mi2.ItemID,mi2.date,mi2.ValidStatus
                                                                )
+                   -- select distinct mi2fc.ItemID from mi2fc
                                  -- FC --- updated 12/7/2018 to include MI in table variable ( Or Temp table)
                                  ,fc_mas as ( select * from JDE_DB_Alan.vw_FC f
                                                        --where f.ItemNumber in ('18.010.035','42.210.031')                     -- deliberately choose 2 items in v                                                            w_FC, 1 is 18.010.035 which also exists in MI_orig table, 1 is 42.210.031 which does exist in Mi_orig table but exists in vw_FC master table to check what result i                                                            t will yield after Join --- 25/7/2018
+                                                         -- where f.ItemNumber in ('26.800.833')
                                                                -- and f.Date < '2019-03-02'                                                            -- choose s                                                            mall date range to return small data set for easy manupilation
                                                           )
                                  ,_fc as

@@ -31,7 +41,7 @@
                                                   --from fc_mas f full outer join JDE_DB_Alan.FCPRO_MI_2_Raw_Data_tmp f_ on f.ItemNumber = f_.ItemID and f.Date =                                                             f_.Date              -- 31/7/2018, change table name -- use this will have all data (includes 18.013.089) but big recordsets, because you are picking up all SKUs i                                                            n 'Master' file regardless if they have forecast or not ( currently you filter out items has no sales history over last 12 months and prevent them generating fc )
        --- ?
                                                     from fc_mas f full outer join mi2fc f_ on f.ItemNumber = f_.ItemID and f.Date = f_.Date
                        -- 1/8/2018, Need to combine multip entry for 1 SKU; Also change table name -- use this will have all data (includes 18.013.089) but big re                                                            cordsets, because you are picking up all SKUs in 'Master' file regardless if they have forecast or not ( currently you filter out items has no sales history over l                                                            ast 12 months and prevent them generating fc )    --- ?
                                                 )
-                                --  select * from _fc
+                                 -- select * from _fc where _fc.ItemID in ('18.013.089')
                                 ,fc as

                                           ( select f.ItemID,f.myFcDate,f.myFcQty,f.ItemNumber,f.Date,f.FCDate_,f.FC_Vol
                                                                ,case when f.myFcQty is null then f.FC_Vol
                                        -- if Item doest not exists in MI raw but exists in vw_FC master
@@ -57,12 +67,14 @@
:
diff --git a/MI_Sim_Code.txt b/MI_Sim_Code.txt
index 8c25304..ed62126 100644
--- a/MI_Sim_Code.txt
+++ b/MI_Sim_Code.txt
@@ -1,23 +1,33 @@
- with po as (
+       use JDE_DB_Alan
+       go
+SQLQuery_HD_sp_MI_Raw_2_Combine_Mismatch_Old.sql
+
+        --- Old MI Code --> [JDE_DB_Alan].[sp_MI_2_Raw_Combine_Mismatch] --- 3/8/2018 ---
+       ---first sumarize PO by month ---
+                with po as (
                                                 select tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb.TransactionOriginator                                                            ,tb.TransactionOrigName,tb.SupplierName
                                                                ,sum(tb.PO_Volume) as PO_Vol
                                                        from JDE_DB_Alan.vw_OpenPO tb
                                                 -- where tb.ItemNumber in  ( select splitdata from JDE_DB_Alan.dbo.fnSplitString(@Item_id,','))
                                                  group by tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb.TransactionOrigina                                                            tor,tb.TransactionOrigName,tb.SupplierName

-                                                 )
+                                         )
                                        --select * from po

                                        ---  Need to aggregate FC for Single SKU ---  1/8/2018
                    ,mi2fc as ( select mi2.ItemID,mi2.Date,mi2.ValidStatus,sum(mi2.Value) as value
                                                                from JDE_DB_Alan.FCPRO_MI_2_Raw_Data_tmp mi2
-                                                               where mi2.ValidStatus = 'S'                                                             -- ' S' den                                                            otes for Simulation only   --- 2/8/2018 --- only pickup S items for Simulation, when MI confirmed you need to put Y instead of Y
-                                                                    and mi2.Value >0
        --- Need to pick up non Zero value  --3/8/2018
+                                                               where mi2.ValidStatus = 'Y'
+                                                               --where mi2.ValidStatus = 'S'                                                           -- ' S' den                                                            :
diff --git a/MI_Sim_Code.txt b/MI_Sim_Code.txt
index 8c25304..ed62126 100644
--- a/MI_Sim_Code.txt
+++ b/MI_Sim_Code.txt
@@ -1,23 +1,33 @@
- with po as (
+       use JDE_DB_Alan
+       go
+SQLQuery_HD_sp_MI_Raw_2_Combine_Mismatch_Old.sql
+
+        --- Old MI Code --> [JDE_DB_Alan].[sp_MI_2_Raw_Combine_Mismatch] --- 3/8/2018 ---
+       ---first sumarize PO by month ---
+                with po as (
                                                 select tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb.TransactionOriginator                                                            ,tb.TransactionOrigName,tb.SupplierName
                                                                ,sum(tb.PO_Volume) as PO_Vol
                                                        from JDE_DB_Alan.vw_OpenPO tb
                                                 -- where tb.ItemNumber in  ( select splitdata from JDE_DB_Alan.dbo.fnSplitString(@Item_id,','))
                                                  group by tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb.TransactionOrigina                                                            tor,tb.TransactionOrigName,tb.SupplierName

-                                                 )
+                                         )
                                        --select * from po

                                        ---  Need to aggregate FC for Single SKU ---  1/8/2018
                    ,mi2fc as ( select mi2.ItemID,mi2.Date,mi2.ValidStatus,sum(mi2.Value) as value
                                                                from JDE_DB_Alan.FCPRO_MI_2_Raw_Data_tmp mi2
-                                                               where mi2.ValidStatus = 'S'                                                             -- ' S' den                                                            otes for Simulation only   --- 2/8/2018 --- only pickup S items for Simulation, when MI confirmed you need to put Y instead of Y
-                                                                    and mi2.Value >0
        --- Need to pick up non Zero value  --3/8/2018
+                                                               where mi2.ValidStatus = 'Y'
+                                                               --where mi2.ValidStatus = 'S'                                                           -- ' S' den                                                            otes for Simulation only   --- 2/8/2018 --- only pickup S items for Simulation, when MI confirmed you need to put Y instead of S
+                                                                and mi2.Value >0
        --- Need to pick up non Zero value  --3/8/2018
+                                                                  --  and mi2.ItemID in ('18.010.035')
                                                                group by mi2.ItemID,mi2.date,mi2.ValidStatus
                                                                )
+                   -- select distinct mi2fc.ItemID from mi2fc
                                  -- FC --- updated 12/7/2018 to include MI in table variable ( Or Temp table)
                                  ,fc_mas as ( select * from JDE_DB_Alan.vw_FC f
                                                        --where f.ItemNumber in ('18.010.035','42.210.031')                     -- deliberately choose 2 items in v                                                            w_FC, 1 is 18.010.035 which also exists in MI_orig table, 1 is 42.210.031 which does exist in Mi_orig table but exists in vw_FC master table to check what result i                                                            t will yield after Join --- 25/7/2018
+                                                         -- where f.ItemNumber in ('26.800.833')
                                                                -- and f.Date < '2019-03-02'                                                            -- choose s                                                            mall date range to return small data set for easy manupilation
                                                           )
                                  ,_fc as

@@ -31,7 +41,7 @@
                                                   --from fc_mas f full outer join JDE_DB_Alan.FCPRO_MI_2_Raw_Data_tmp f_ on f.ItemNumber = f_.ItemID and f.Date =                                                             f_.Date              -- 31/7/2018, change table name -- use this will have all data (includes 18.013.089) but big recordsets, because you are picking up all SKUs i                                                            n 'Master' file regardless if they have forecast or not ( currently you filter out items has no sales history over last 12 months and prevent them generating fc )
        --- ?
                                                     from fc_mas f full outer join mi2fc f_ on f.ItemNumber = f_.ItemID and f.Date = f_.Date
                        -- 1/8/2018, Need to combine multip entry for 1 SKU; Also change table name -- use this will have all data (includes 18.013.089) but big re                                                            cordsets, because you are picking up all SKUs in 'Master' file regardless if they have forecast or not ( currently you filter out items has no sales history over l                                                            ast 12 months and prevent them generating fc )    --- ?
                                                 )
-                                --  select * from _fc
+                                 -- select * from _fc where _fc.ItemID in ('18.013.089')
:
diff --git a/MI_Sim_Code.txt b/MI_Sim_Code.txt
index 8c25304..ed62126 100644
--- a/MI_Sim_Code.txt
+++ b/MI_Sim_Code.txt
@@ -1,23 +1,33 @@
- with po as (
+       use JDE_DB_Alan
+       go
+SQLQuery_HD_sp_MI_Raw_2_Combine_Mismatch_Old.sql
+
+        --- Old MI Code --> [JDE_DB_Alan].[sp_MI_2_Raw_Combine_Mismatch] --- 3/8/2018 ---
+       ---first sumarize PO by month ---
+                with po as (
                                                 select tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb.TransactionOriginator,tb.TransactionOrigName,t                                   b.SupplierName
                                                                ,sum(tb.PO_Volume) as PO_Vol
                                                        from JDE_DB_Alan.vw_OpenPO tb
                                                 -- where tb.ItemNumber in  ( select splitdata from JDE_DB_Alan.dbo.fnSplitString(@Item_id,','))
                                                  group by tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb.TransactionOriginator,tb.TransactionOrigNam                                   e,tb.SupplierName

-                                                 )
+                                         )
                                        --select * from po

                                        ---  Need to aggregate FC for Single SKU ---  1/8/2018
                    ,mi2fc as ( select mi2.ItemID,mi2.Date,mi2.ValidStatus,sum(mi2.Value) as value
                                                                from JDE_DB_Alan.FCPRO_MI_2_Raw_Data_tmp mi2
-                                                               where mi2.ValidStatus = 'S'                                                             -- ' S' denotes for Simulation only                                      --- 2/8/2018 --- only pickup S items for Simulation, when MI confirmed you need to put Y instead of Y
-                                                                    and mi2.Value >0                                                                                   --- Need to pick up                                    non Zero value  --3/8/2018
+                                                               where mi2.ValidStatus = 'Y'
+                                                               --where mi2.ValidStatus = 'S'                                                           -- ' S' denotes for Simulation only                                      --- 2/8/2018 --- only pickup S items for Simulation, when MI confirmed you need to put Y instead of S
+                                                                and mi2.Value >0                                                                                       --- Need to pick up                                    non Zero value  --3/8/2018
+                                                                  --  and mi2.ItemID in ('18.010.035')
                                                                group by mi2.ItemID,mi2.date,mi2.ValidStatus
                                                                )
+                   -- select distinct mi2fc.ItemID from mi2fc
                                  -- FC --- updated 12/7/2018 to include MI in table variable ( Or Temp table)
                                  ,fc_mas as ( select * from JDE_DB_Alan.vw_FC f
                                                        --where f.ItemNumber in ('18.010.035','42.210.031')                     -- deliberately choose 2 items in vw_FC, 1 is 18.010.035 whi                                   ch also exists in MI_orig table, 1 is 42.210.031 which does exist in Mi_orig table but exists in vw_FC master table to check what result it will yield after Join --- 25/7/2018
+                                                         -- where f.ItemNumber in ('26.800.833')
                                                                -- and f.Date < '2019-03-02'                                                            -- choose small date range to return                                    small data set for easy manupilation
                                                           )
                                  ,_fc as
@@ -31,7 +41,7 @@
                                                   --from fc_mas f full outer join JDE_DB_Alan.FCPRO_MI_2_Raw_Data_tmp f_ on f.ItemNumber = f_.ItemID and f.Date = f_.Date              -- 3                                   1/7/2018, change table name -- use this will have all data (includes 18.013.089) but big recordsets, because you are picking up all SKUs in 'Master' file regardless if they have forecast o                                   r not ( currently you filter out items has no sales history over last 12 months and prevent them generating fc )        --- ?
                                                     from fc_mas f full outer join mi2fc f_ on f.ItemNumber = f_.ItemID and f.Date = f_.Date                                            -- 1                                   /8/2018, Need to combine multip entry for 1 SKU; Also change table name -- use this will have all data (includes 18.013.089) but big recordsets, because you are picking up all SKUs in 'Mas                                   ter' file regardless if they have forecast or not ( currently you filter out items has no sales history over last 12 months and prevent them generating fc )    --- ?

                                                 )
-                                --  select * from _fc
+                                 -- select * from _fc where _fc.ItemID in ('18.013.089')
                                 ,fc as
                                           ( select f.ItemID,f.myFcDate,f.myFcQty,f.ItemNumber,f.Date,f.FCDate_,f.FC_Vol
                                                                ,case when f.myFcQty is null then f.FC_Vol
:
diff --git a/MI_Sim_Code.txt b/MI_Sim_Code.txt
index 8c25304..ed62126 100644
--- a/MI_Sim_Code.txt
+++ b/MI_Sim_Code.txt
@@ -1,23 +1,33 @@
- with po as (
+       use JDE_DB_Alan
+       go
+SQLQuery_HD_sp_MI_Raw_2_Combine_Mismatch_Old.sql
+
+        --- Old MI Code --> [JDE_DB_Alan].[sp_MI_2_Raw_Combine_Mismatch] --- 3/8/2018 ---
+       ---first sumarize PO by month ---
+                with po as (
                                                 select tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb.TransactionOriginator,tb.TransactionOrigName,tb.SupplierName
                                                                ,sum(tb.PO_Volume) as PO_Vol
                                                        from JDE_DB_Alan.vw_OpenPO tb
                                                 -- where tb.ItemNumber in  ( select splitdata from JDE_DB_Alan.dbo.fnSplitString(@Item_id,','))
                                                  group by tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb.TransactionOriginator,tb.TransactionOrigName,tb.SupplierName

-                                                 )
+                                         )
                                        --select * from po

                                        ---  Need to aggregate FC for Single SKU ---  1/8/2018
                    ,mi2fc as ( select mi2.ItemID,mi2.Date,mi2.ValidStatus,sum(mi2.Value) as value
                                                                from JDE_DB_Alan.FCPRO_MI_2_Raw_Data_tmp mi2
-                                                               where mi2.ValidStatus = 'S'                                                             -- ' S' denotes for Simulation only   --- 2/8/2018 ---                 only pickup S items for Simulation, when MI confirmed you need to put Y instead of Y
-                                                                    and mi2.Value >0                                                                                   --- Need to pick up non Zero value  --3                /8/2018
+                                                               where mi2.ValidStatus = 'Y'
+                                                               --where mi2.ValidStatus = 'S'                                                           -- ' S' denotes for Simulation only   --- 2/8/2018 ---                 only pickup S items for Simulation, when MI confirmed you need to put Y instead of S
+                                                                and mi2.Value >0                                                                                       --- Need to pick up non Zero value  --3                /8/2018
+                                                                  --  and mi2.ItemID in ('18.010.035')
                                                                group by mi2.ItemID,mi2.date,mi2.ValidStatus
                                                                )
+                   -- select distinct mi2fc.ItemID from mi2fc
                                  -- FC --- updated 12/7/2018 to include MI in table variable ( Or Temp table)
                                  ,fc_mas as ( select * from JDE_DB_Alan.vw_FC f
                                                        --where f.ItemNumber in ('18.010.035','42.210.031')                     -- deliberately choose 2 items in vw_FC, 1 is 18.010.035 which also exists in M                I_orig table, 1 is 42.210.031 which does exist in Mi_orig table but exists in vw_FC master table to check what result it will yield after Join --- 25/7/2018
+                                                         -- where f.ItemNumber in ('26.800.833')
                                                                -- and f.Date < '2019-03-02'                                                            -- choose small date range to return small data set for                 easy manupilation
                                                           )
                                  ,_fc as
@@ -31,7 +41,7 @@
                                                   --from fc_mas f full outer join JDE_DB_Alan.FCPRO_MI_2_Raw_Data_tmp f_ on f.ItemNumber = f_.ItemID and f.Date = f_.Date              -- 31/7/2018, change ta                ble name -- use this will have all data (includes 18.013.089) but big recordsets, because you are picking up all SKUs in 'Master' file regardless if they have forecast or not ( currently you filter out items                 has no sales history over last 12 months and prevent them generating fc )        --- ?
                                                     from fc_mas f full outer join mi2fc f_ on f.ItemNumber = f_.ItemID and f.Date = f_.Date                                            -- 1/8/2018, Need to co                mbine multip entry for 1 SKU; Also change table name -- use this will have all data (includes 18.013.089) but big recordsets, because you are picking up all SKUs in 'Master' file regardless if they have fore                cast or not ( currently you filter out items has no sales history over last 12 months and prevent them generating fc )    --- ?
                                                 )
-                                --  select * from _fc
+                                 -- select * from _fc where _fc.ItemID in ('18.013.089')
                                 ,fc as
                                           ( select f.ItemID,f.myFcDate,f.myFcQty,f.ItemNumber,f.Date,f.FCDate_,f.FC_Vol
                                                                ,case when f.myFcQty is null then f.FC_Vol                                                                                              -- if I                tem doest not exists in MI raw but exists in vw_FC master
@@ -57,12 +67,14 @@
                                                --  from  @mymi f_  left join JDE_DB_Alan.vw_FC f on f.ItemNumber = f_.ItemID and f.FCDate_ = f_.FcDate_Raw                     --- not good causing big proble                :
diff --git a/MI_Sim_Code.txt b/MI_Sim_Code.txt
index 8c25304..ed62126 100644
--- a/MI_Sim_Code.txt
+++ b/MI_Sim_Code.txt
@@ -1,23 +1,33 @@
- with po as (
+       use JDE_DB_Alan
+       go
+SQLQuery_HD_sp_MI_Raw_2_Combine_Mismatch_Old.sql
+
+        --- Old MI Code --> [JDE_DB_Alan].[sp_MI_2_Raw_Combine_Mismatch] --- 3/8/2018 ---
+       ---first sumarize PO by month ---
+                with po as (
                                                 select tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb.TransactionOriginator,tb.TransactionOrigName,tb.SupplierName
                                                                ,sum(tb.PO_Volume) as PO_Vol
                                                        from JDE_DB_Alan.vw_OpenPO tb
                                                 -- where tb.ItemNumber in  ( select splitdata from JDE_DB_Alan.dbo.fnSplitString(@Item_id,','))
                                                  group by tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb.TransactionOriginator,tb.TransactionOrigName,tb.SupplierName

-                                                 )
+                                         )
                                        --select * from po

                                        ---  Need to aggregate FC for Single SKU ---  1/8/2018
                    ,mi2fc as ( select mi2.ItemID,mi2.Date,mi2.ValidStatus,sum(mi2.Value) as value
                                                                from JDE_DB_Alan.FCPRO_MI_2_Raw_Data_tmp mi2
-                                                               where mi2.ValidStatus = 'S'                                                             -- ' S' denotes for Simulation only   --- 2/8/2018 --- only pickup S    items for Simulation, when MI confirmed you need to put Y instead of Y
-                                                                    and mi2.Value >0                                                                                   --- Need to pick up non Zero value  --3/8/2018
+                                                               where mi2.ValidStatus = 'Y'
+                                                               --where mi2.ValidStatus = 'S'                                                           -- ' S' denotes for Simulation only   --- 2/8/2018 --- only pickup S    items for Simulation, when MI confirmed you need to put Y instead of S
+                                                                and mi2.Value >0                                                                                       --- Need to pick up non Zero value  --3/8/2018
+                                                                  --  and mi2.ItemID in ('18.010.035')
                                                                group by mi2.ItemID,mi2.date,mi2.ValidStatus
                                                                )
+                   -- select distinct mi2fc.ItemID from mi2fc
                                  -- FC --- updated 12/7/2018 to include MI in table variable ( Or Temp table)
                                  ,fc_mas as ( select * from JDE_DB_Alan.vw_FC f
                                                        --where f.ItemNumber in ('18.010.035','42.210.031')                     -- deliberately choose 2 items in vw_FC, 1 is 18.010.035 which also exists in MI_orig table,    1 is 42.210.031 which does exist in Mi_orig table but exists in vw_FC master table to check what result it will yield after Join --- 25/7/2018
+                                                         -- where f.ItemNumber in ('26.800.833')
                                                                -- and f.Date < '2019-03-02'                                                            -- choose small date range to return small data set for easy manupil   ation
                                                           )
                                  ,_fc as
@@ -31,7 +41,7 @@
                                                   --from fc_mas f full outer join JDE_DB_Alan.FCPRO_MI_2_Raw_Data_tmp f_ on f.ItemNumber = f_.ItemID and f.Date = f_.Date              -- 31/7/2018, change table name -- u   se this will have all data (includes 18.013.089) but big recordsets, because you are picking up all SKUs in 'Master' file regardless if they have forecast or not ( currently you filter out items has no sales history over    last 12 months and prevent them generating fc )        --- ?
                                                     from fc_mas f full outer join mi2fc f_ on f.ItemNumber = f_.ItemID and f.Date = f_.Date                                            -- 1/8/2018, Need to combine multip    entry for 1 SKU; Also change table name -- use this will have all data (includes 18.013.089) but big recordsets, because you are picking up all SKUs in 'Master' file regardless if they have forecast or not ( currently yo   u filter out items has no sales history over last 12 months and prevent them generating fc )    --- ?
                                                 )
-                                --  select * from _fc
+                                 -- select * from _fc where _fc.ItemID in ('18.013.089')
                                 ,fc as
                                           ( select f.ItemID,f.myFcDate,f.myFcQty,f.ItemNumber,f.Date,f.FCDate_,f.FC_Vol
                                                                ,case when f.myFcQty is null then f.FC_Vol                                                                                              -- if Item doest not    exists in MI raw but exists in vw_FC master
@@ -57,12 +67,14 @@
                                                --  from  @mymi f_  left join JDE_DB_Alan.vw_FC f on f.ItemNumber = f_.ItemID and f.FCDate_ = f_.FcDate_Raw                     --- not good causing big problems for SOH et   c because on Mi raw table you only have 1 or 2 or 3 month, say if MI is for 2018-09 then you will not get SOH ( since SOH is always default to current month you are in ) and you need visibility for each month, YOU can us   e left join if you are not concerning SOH figure but in order to keep your code consistent, you should keep use full outer join and filter out on specific SKUs at end,this might best solution for this issue 25/7/2018 ---   :
diff --git a/MI_Sim_Code.txt b/MI_Sim_Code.txt
index 8c25304..ed62126 100644
--- a/MI_Sim_Code.txt
+++ b/MI_Sim_Code.txt
@@ -1,23 +1,33 @@
- with po as (
+       use JDE_DB_Alan
+       go
+SQLQuery_HD_sp_MI_Raw_2_Combine_Mismatch_Old.sql
+
+        --- Old MI Code --> [JDE_DB_Alan].[sp_MI_2_Raw_Combine_Mismatch] --- 3/8/2018 ---
+       ---first sumarize PO by month ---
+                with po as (
                                                 select tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb.TransactionOriginator,tb.TransactionOrigName,tb.SupplierName
                                                                ,sum(tb.PO_Volume) as PO_Vol
                                                        from JDE_DB_Alan.vw_OpenPO tb
                                                 -- where tb.ItemNumber in  ( select splitdata from JDE_DB_Alan.dbo.fnSplitString(@Item_id,','))
                                                  group by tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb.TransactionOriginator,tb.TransactionOrigName,tb.SupplierName

-                                                 )
+                                         )
                                        --select * from po

                                        ---  Need to aggregate FC for Single SKU ---  1/8/2018
                    ,mi2fc as ( select mi2.ItemID,mi2.Date,mi2.ValidStatus,sum(mi2.Value) as value
                                                                from JDE_DB_Alan.FCPRO_MI_2_Raw_Data_tmp mi2
-                                                               where mi2.ValidStatus = 'S'                                                             -- ' S' denotes for Simulation only   --- 2/8/2018 --- only pickup S itulation, when MI confirmed you need to put Y instead of Y
-                                                                    and mi2.Value >0                                                                                   --- Need to pick up non Zero value  --3/8/2018
+                                                               where mi2.ValidStatus = 'Y'
+                                                               --where mi2.ValidStatus = 'S'                                                           -- ' S' denotes for Simulation only   --- 2/8/2018 --- only pickup S itulation, when MI confirmed you need to put Y instead of S
+                                                                and mi2.Value >0                                                                                       --- Need to pick up non Zero value  --3/8/2018
+                                                                  --  and mi2.ItemID in ('18.010.035')
                                                                group by mi2.ItemID,mi2.date,mi2.ValidStatus
                                                                )
+                   -- select distinct mi2fc.ItemID from mi2fc
                                  -- FC --- updated 12/7/2018 to include MI in table variable ( Or Temp table)
                                  ,fc_mas as ( select * from JDE_DB_Alan.vw_FC f
                                                        --where f.ItemNumber in ('18.010.035','42.210.031')                     -- deliberately choose 2 items in vw_FC, 1 is 18.010.035 which also exists in MI_orig table, 1 31 which does exist in Mi_orig table but exists in vw_FC master table to check what result it will yield after Join --- 25/7/2018
+                                                         -- where f.ItemNumber in ('26.800.833')
                                                                -- and f.Date < '2019-03-02'                                                            -- choose small date range to return small data set for easy manupilati
                                                           )
                                  ,_fc as
@@ -31,7 +41,7 @@
                                                   --from fc_mas f full outer join JDE_DB_Alan.FCPRO_MI_2_Raw_Data_tmp f_ on f.ItemNumber = f_.ItemID and f.Date = f_.Date              -- 31/7/2018, change table name -- use ave all data (includes 18.013.089) but big recordsets, because you are picking up all SKUs in 'Master' file regardless if they have forecast or not ( currently you filter out items has no sales history over last 12 months athem generating fc )        --- ?
                                                     from fc_mas f full outer join mi2fc f_ on f.ItemNumber = f_.ItemID and f.Date = f_.Date                                            -- 1/8/2018, Need to combine multip entU; Also change table name -- use this will have all data (includes 18.013.089) but big recordsets, because you are picking up all SKUs in 'Master' file regardless if they have forecast or not ( currently you filter out itemles history over last 12 months and prevent them generating fc )    --- ?
                                                 )
-                                --  select * from _fc
+                                 -- select * from _fc where _fc.ItemID in ('18.013.089')
                                 ,fc as
                                           ( select f.ItemID,f.myFcDate,f.myFcQty,f.ItemNumber,f.Date,f.FCDate_,f.FC_Vol
                                                                ,case when f.myFcQty is null then f.FC_Vol                                                                                              -- if Item doest not exraw but exists in vw_FC master
@@ -57,12 +67,14 @@
                                                --  from  @mymi f_  left join JDE_DB_Alan.vw_FC f on f.ItemNumber = f_.ItemID and f.FCDate_ = f_.FcDate_Raw                     --- not good causing big problems for SOH etc bi raw table you only have 1 or 2 or 3 month, say if MI is for 2018-09 then you will not get SOH ( since SOH is always default to current month you are in ) and you need visibility for each month, YOU can use left join if yooncerning SOH figure but in order to keep your code consistent, you should keep use full outer join and filter out on specific SKUs at end,this might best solution for this issue 25/7/2018 --- Will Use this lead to risk of m has no sales history 18.013.089 --- No ???
:
diff --git a/MI_Sim_Code.txt b/MI_Sim_Code.txt
index 8c25304..ed62126 100644
--- a/MI_Sim_Code.txt
+++ b/MI_Sim_Code.txt
@@ -1,23 +1,33 @@
- with po as (
+       use JDE_DB_Alan
+       go
+SQLQuery_HD_sp_MI_Raw_2_Combine_Mismatch_Old.sql
+
+        --- Old MI Code --> [JDE_DB_Alan].[sp_MI_2_Raw_Combine_Mismatch] --- 3/8/2018 ---
+       ---first sumarize PO by month ---
+                with po as (
                                                 select tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb.TransactionOriginator,tb.TransactionOrigName,tb.SupplierName
                                                                ,sum(tb.PO_Volume) as PO_Vol
                                                        from JDE_DB_Alan.vw_OpenPO tb
                                                 -- where tb.ItemNumber in  ( select splitdata from JDE_DB_Alan.dbo.fnSplitString(@Item_id,','))
                                                  group by tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb.TransactionOriginator,tb.TransactionOrigName,tb.SupplierName

-                                                 )
+                                         )
                                        --select * from po

                                        ---  Need to aggregate FC for Single SKU ---  1/8/2018
                    ,mi2fc as ( select mi2.ItemID,mi2.Date,mi2.ValidStatus,sum(mi2.Value) as value
                                                                from JDE_DB_Alan.FCPRO_MI_2_Raw_Data_tmp mi2
-                                                               where mi2.ValidStatus = 'S'                                                             -- ' S' denotes for Simulation only   --- 2/8/2018 --- only pickup S it to put Y instead of Y
-                                                                    and mi2.Value >0                                                                                   --- Need to pick up non Zero value  --3/8/2018
+                                                               where mi2.ValidStatus = 'Y'
+                                                               --where mi2.ValidStatus = 'S'                                                           -- ' S' denotes for Simulation only   --- 2/8/2018 --- only pickup S it to put Y instead of S
+                                                                and mi2.Value >0                                                                                       --- Need to pick up non Zero value  --3/8/2018
+                                                                  --  and mi2.ItemID in ('18.010.035')
                                                                group by mi2.ItemID,mi2.date,mi2.ValidStatus
                                                                )
+                   -- select distinct mi2fc.ItemID from mi2fc
                                  -- FC --- updated 12/7/2018 to include MI in table variable ( Or Temp table)
                                  ,fc_mas as ( select * from JDE_DB_Alan.vw_FC f
                                                        --where f.ItemNumber in ('18.010.035','42.210.031')                     -- deliberately choose 2 items in vw_FC, 1 is 18.010.035 which also exists in MI_orig table, 1 e but exists in vw_FC master table to check what result it will yield after Join --- 25/7/2018
+                                                         -- where f.ItemNumber in ('26.800.833')
                                                                -- and f.Date < '2019-03-02'                                                            -- choose small date range to return small data set for easy manupilati
                                                           )
                                  ,_fc as
@@ -31,7 +41,7 @@
                                                   --from fc_mas f full outer join JDE_DB_Alan.FCPRO_MI_2_Raw_Data_tmp f_ on f.ItemNumber = f_.ItemID and f.Date = f_.Date              -- 31/7/2018, change table name -- use but big recordsets, because you are picking up all SKUs in 'Master' file regardless if they have forecast or not ( currently you filter out items has no sales history over last 12 months and prevent them generating fc )
                                                     from fc_mas f full outer join mi2fc f_ on f.ItemNumber = f_.ItemID and f.Date = f_.Date                                            -- 1/8/2018, Need to combine multip entis will have all data (includes 18.013.089) but big recordsets, because you are picking up all SKUs in 'Master' file regardless if they have forecast or not ( currently you filter out items has no sales history over last 12- ?
                                                 )
-                                --  select * from _fc
+                                 -- select * from _fc where _fc.ItemID in ('18.013.089')
                                 ,fc as
                                           ( select f.ItemID,f.myFcDate,f.myFcQty,f.ItemNumber,f.Date,f.FCDate_,f.FC_Vol
                                                                ,case when f.myFcQty is null then f.FC_Vol                                                                                              -- if Item doest not ex
@@ -57,12 +67,14 @@
                                                --  from  @mymi f_  left join JDE_DB_Alan.vw_FC f on f.ItemNumber = f_.ItemID and f.FCDate_ = f_.FcDate_Raw                     --- not good causing big problems for SOH etc b 3 month, say if MI is for 2018-09 then you will not get SOH ( since SOH is always default to current month you are in ) and you need visibility for each month, YOU can use left join if you are not concerning SOH figure butould keep use full outer join and filter out on specific SKUs at end,this might best solution for this issue 25/7/2018 --- Will Use this lead to risk of lossing item has no sales history 18.013.089 --- No ???
                                                -- where f.ItemNumber in ( '42.210.031','24.7207.4459')
                                                         --  and f.Date < '2019-03-01'
-                                                --where f.ItemNumber in ('18.010.035')
:
diff --git a/MI_Sim_Code.txt b/MI_Sim_Code.txt
index 8c25304..ed62126 100644
--- a/MI_Sim_Code.txt
+++ b/MI_Sim_Code.txt
@@ -1,23 +1,33 @@
- with po as (
+       use JDE_DB_Alan
+       go
+SQLQuery_HD_sp_MI_Raw_2_Combine_Mismatch_Old.sql
+
+        --- Old MI Code --> [JDE_DB_Alan].[sp_MI_2_Raw_Combine_Mismatch] --- 3/8/2018 ---
+       ---first sumarize PO by month ---
+                with po as (
                                                 select tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb.TransactionOriginator,tb.TransactionOrigName,tb.SupplierName
                                                                ,sum(tb.PO_Volume) as PO_Vol
                                                        from JDE_DB_Alan.vw_OpenPO tb
                                                 -- where tb.ItemNumber in  ( select splitdata from JDE_DB_Alan.dbo.fnSplitString(@Item_id,','))
                                                  group by tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb.TransactionOriginator,tb.TransactionOrigName,tb.SupplierName

-                                                 )
+                                         )
                                        --select * from po

                                        ---  Need to aggregate FC for Single SKU ---  1/8/2018
                    ,mi2fc as ( select mi2.ItemID,mi2.Date,mi2.ValidStatus,sum(mi2.Value) as value
                                                                from JDE_DB_Alan.FCPRO_MI_2_Raw_Data_tmp mi2
-                                                               where mi2.ValidStatus = 'S'                                                             -- ' S' denotes for Simulation only   --- 2/8/2018 --- only pickup S ithen MI confirmed you need to put Y instead of Y
-                                                                    and mi2.Value >0                                                                                   --- Need to pick up non Zero value  --3/8/2018
+                                                               where mi2.ValidStatus = 'Y'
+                                                               --where mi2.ValidStatus = 'S'                                                           -- ' S' denotes for Simulation only   --- 2/8/2018 --- only pickup S ithen MI confirmed you need to put Y instead of S
+                                                                and mi2.Value >0                                                                                       --- Need to pick up non Zero value  --3/8/2018
+                                                                  --  and mi2.ItemID in ('18.010.035')
                                                                group by mi2.ItemID,mi2.date,mi2.ValidStatus
                                                                )
+                   -- select distinct mi2fc.ItemID from mi2fc
                                  -- FC --- updated 12/7/2018 to include MI in table variable ( Or Temp table)
                                  ,fc_mas as ( select * from JDE_DB_Alan.vw_FC f
                                                        --where f.ItemNumber in ('18.010.035','42.210.031')                     -- deliberately choose 2 items in vw_FC, 1 is 18.010.035 which also exists in MI_orig table, 1 oes exist in Mi_orig table but exists in vw_FC master table to check what result it will yield after Join --- 25/7/2018
+                                                         -- where f.ItemNumber in ('26.800.833')
                                                                -- and f.Date < '2019-03-02'                                                            -- choose small date range to return small data set for easy manupilati
                                                           )
                                  ,_fc as
@@ -31,7 +41,7 @@
                                                   --from fc_mas f full outer join JDE_DB_Alan.FCPRO_MI_2_Raw_Data_tmp f_ on f.ItemNumber = f_.ItemID and f.Date = f_.Date              -- 31/7/2018, change table name -- use ta (includes 18.013.089) but big recordsets, because you are picking up all SKUs in 'Master' file regardless if they have forecast or not ( currently you filter out items has no sales history over last 12 months and prevent        --- ?
                                                     from fc_mas f full outer join mi2fc f_ on f.ItemNumber = f_.ItemID and f.Date = f_.Date                                            -- 1/8/2018, Need to combine multip entange table name -- use this will have all data (includes 18.013.089) but big recordsets, because you are picking up all SKUs in 'Master' file regardless if they have forecast or not ( currently you filter out items has no st 12 months and prevent them generating fc )    --- ?
                                                 )
-                                --  select * from _fc
+                                 -- select * from _fc where _fc.ItemID in ('18.013.089')
                                 ,fc as
                                           ( select f.ItemID,f.myFcDate,f.myFcQty,f.ItemNumber,f.Date,f.FCDate_,f.FC_Vol
                                                                ,case when f.myFcQty is null then f.FC_Vol                                                                                              -- if Item doest not exists in vw_FC master
@@ -57,12 +67,14 @@
                                                --  from  @mymi f_  left join JDE_DB_Alan.vw_FC f on f.ItemNumber = f_.ItemID and f.FCDate_ = f_.FcDate_Raw                     --- not good causing big problems for SOH etc be you only have 1 or 2 or 3 month, say if MI is for 2018-09 then you will not get SOH ( since SOH is always default to current month you are in ) and you need visibility for each month, YOU can use left join if you are not  but in order to keep your code consistent, you should keep use full outer join and filter out on specific SKUs at end,this might best solution for this issue 25/7/2018 --- Will Use this lead to risk of lossing item has no 089 --- No ???
:
diff --git a/MI_Sim_Code.txt b/MI_Sim_Code.txt
index 8c25304..ed62126 100644
--- a/MI_Sim_Code.txt
+++ b/MI_Sim_Code.txt
@@ -1,23 +1,33 @@
- with po as (
+       use JDE_DB_Alan
+       go
+SQLQuery_HD_sp_MI_Raw_2_Combine_Mismatch_Old.sql
+
+        --- Old MI Code --> [JDE_DB_Alan].[sp_MI_2_Raw_Combine_Mismatch] --- 3/8/2018 ---
+       ---first sumarize PO by month ---
+                with po as (
                                                 select tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb.TransactionOriginator,tb.TransactionOrigName,tb.SupplierName
                                                                ,sum(tb.PO_Volume) as PO_Vol
                                                        from JDE_DB_Alan.vw_OpenPO tb
                                                 -- where tb.ItemNumber in  ( select splitdata from JDE_DB_Alan.dbo.fnSplitString(@Item_id,','))
                                                  group by tb.ItemNumber,tb.DataType1,tb.PODate_,tb.poyr,tb.pomth,tb.BuyerName,tb.BuyerNumber,tb.TransactionOriginator,tb.TransactionOrigName,tb.SupplierName

-                                                 )
+                                         )
                                        --select * from po

                                        ---  Need to aggregate FC for Single SKU ---  1/8/2018
                    ,mi2fc as ( select mi2.ItemID,mi2.Date,mi2.ValidStatus,sum(mi2.Value) as value
                                                                from JDE_DB_Alan.FCPRO_MI_2_Raw_Data_tmp mi2
-                                                               where mi2.ValidStatus = 'S'                                                             -- ' S' denotes for Simulation only   --- 2/8/2018 --- only pickup S it Simulation, when MI confirmed you need to put Y instead of Y
-                                                                    and mi2.Value >0                                                                                   --- Need to pick up non Zero value  --3/8/2018
+                                                               where mi2.ValidStatus = 'Y'
+                                                               --where mi2.ValidStatus = 'S'                                                           -- ' S' denotes for Simulation only   --- 2/8/2018 --- only pickup S it Simulation, when MI confirmed you need to put Y instead of S
+                                                                and mi2.Value >0                                                                                       --- Need to pick up non Zero value  --3/8/2018
+                                                                  --  and mi2.ItemID in ('18.010.035')
                                                                group by mi2.ItemID,mi2.date,mi2.ValidStatus
                                                                )
+                   -- select distinct mi2fc.ItemID from mi2fc
                                  -- FC --- updated 12/7/2018 to include MI in table variable ( Or Temp table)
                                  ,fc_mas as ( select * from JDE_DB_Alan.vw_FC f
                                                        --where f.ItemNumber in ('18.010.035','42.210.031')                     -- deliberately choose 2 items in vw_FC, 1 is 18.010.035 which also exists in MI_orig table, 1 10.031 which does exist in Mi_orig table but exists in vw_FC master table to check what result it will yield after Join --- 25/7/2018
+                                                         -- where f.ItemNumber in ('26.800.833')
                                                                -- and f.Date < '2019-03-02'                                                            -- choose small date range to return small data set for easy manupilati
                                                           )
                                  ,_fc as
@@ -31,7 +41,7 @@
                                                   --from fc_mas f full outer join JDE_DB_Alan.FCPRO_MI_2_Raw_Data_tmp f_ on f.ItemNumber = f_.ItemID and f.Date = f_.Date              -- 31/7/2018, change table name -- use ll have all data (includes 18.013.089) but big recordsets, because you are picking up all SKUs in 'Master' file regardless if they have forecast or not ( currently you filter out items has no sales history over last 12 montprevent them generating fc )        --- ?
                                                     from fc_mas f full outer join mi2fc f_ on f.ItemNumber = f_.ItemID and f.Date = f_.Date                                            -- 1/8/2018, Need to combine multip ent1 SKU; Also change table name -- use this will have all data (includes 18.013.089) but big recordsets, because you are picking up all SKUs in 'Master' file regardless if they have forecast or not ( currently you filter out as no sales history over last 12 months and prevent them generating fc )    --- ?
                                                 )
-                                --  select * from _fc
+                                 -- select * from _fc where _fc.ItemID in ('18.013.089')
                                 ,fc as
                                           ( select f.ItemID,f.myFcDate,f.myFcQty,f.ItemNumber,f.Date,f.FCDate_,f.FC_Vol
                                                                ,case when f.myFcQty is null then f.FC_Vol                                                                                              -- if Item doest not ex MI raw but exists in vw_FC master
@@ -57,12 +67,14 @@
                                                --  from  @mymi f_  left join JDE_DB_Alan.vw_FC f on f.ItemNumber = f_.ItemID and f.FCDate_ = f_.FcDate_Raw                     --- not good causing big problems for SOH etc bon Mi raw table you only have 1 or 2 or 3 month, say if MI is for 2018-09 then you will not get SOH ( since SOH is always default to current month you are in ) and you need visibility for each month, YOU can use left join ire not concerning SOH figure but in order to keep your code consistent, you should keep use full outer join and filter out on specific SKUs at end,this might best solution for this issue 25/7/2018 --- Will Use this lead to  lossing item has no sales history 18.013.089 --- No ???
                                                -- where f.ItemNumber in ( '42.210.031','24.7207.4459')
                                                         --  and f.Date < '2019-03-01'
-                                                --where f.ItemNumber in ('18.010.035')
+                                               -- where f.ItemNumber in ('18.010.035')
+                                                --where f.ItemID in ('18.013.089')
                                                 )

                                  -- select distinct fc.ItemNumber from fc
-                                 --select  * from fc  where fc.ItemID in ('18.013.089') or fc.ItemNumber in ('18.013.089')                     --- note 18.013.089 has no existence in 'FVPRO_Fcst' table as there is no salesy over 12 month. Therefore when join table you will have unexpected result - be careful here in where condition be careful to which ItemNumber or ItemId you need to use. Also be careful using 'Not In ( )' conditional becausere is null value SQL will return empty dataset ! --- 20/7/2018
-                                 -- select * from fc
+                                 --select  * from fc  where fc.ItemNumber_f in ('18.013.089')
+                                 --select  * from fc  where fc.ItemID in ('18.013.089') or fc.ItemNumber_f in ('18.013.089')                   --- note 18.013.089 has no existence in 'FVPRO_Fcst' table as there is no salesy over 12 month. Therefore when join table you will have unexpected result - be careful here in where condition be careful to which ItemNumber or ItemId you need to use. Also be careful using 'Not In ( )' conditional becausere is null value SQL will return empty dataset ! --- 20/7/2018
+                                  --select * from fc

                                        ,tb as
                                                ( select f.ItemNumber_f,f.FcDate_f,f.Date_f,f.FC_Vol_f as FC_Vol                                -- will it cause issues if you rename 'f.FC_Vol_f' as 'FC_Vol' since you alread'FC_Vol' column ?
@@ -77,14 +89,14 @@

                                                -- from JDE_DB_Alan.vw_FC f left join po p on f.ItemNumber = p.ItemNumber and f.FCDate_ = p.PODate_
                                                  from fc f left join po p on f.ItemNumber_f = p.ItemNumber and f.FcDate_f = p.PODate_
-                                                                                               left join JDE_DB_Alan.vw_Mast m on f.ItemNumber  = m.ItemNumber and f.FCDate_ = m.SOHDate   -- SOHDate is current month name,al 'vw_Mast' is clearn without duplicated records
+                                                                                               left join JDE_DB_Alan.vw_Mast m on f.ItemNumber_f  = m.ItemNumber and f.FCDate_f = m.SOHDate   -- SOHDate is current month nameote 'vw_Mast' is clearn without duplicated records
                                                                                                  --left join JDE_DB_Alan.vw_Mast m on f.ItemNumber_f  = m.ItemNumber
-                                                where f.Date_f< @dt                                                    --- be careful if you have null value resulting from pervious step in join -- you will miss value --- 28
-                                               --  where f.Date < '2018-12-02'
+                                               -- where f.Date_f< @dt                                                  --- be careful if you have null value resulting from pervious step in join -- you will miss value --- 28
+                                                 where f.FcDate_f < '2019-03-02'
                                                          -- and f.ItemNumber in ('45.103.000')
                                                                         )

-                                  --select * from tb order by tb.ItemNumber_f,tb.FCDate_f
+                                  --select * from tb where tb.ItemNumber_f in ('18.013.089') order by tb.ItemNumber_f,tb.FCDate_f
                                          ,tb_ as (
                                                                select tb.ItemNumber_f,tb.Date_f,tb.FCDate_f,tb.FC_Vol,tb.PO_Vol,tb.SOH_Vol
                                                                                ,case
@@ -148,7 +160,9 @@
                                                                                          --  end as mywholesaleprice
                                                                                --from t_ left join pri on t_.ItemNumber = pri.ItemNumber )

-                                               --- Filter out Item does not exist (inner join) Or discontinued ( stocking type )---
+                                               ---===========================================================================================================
+                                               --- Filter out Item does not exist using inner join Or O/U items ( discontinued) by using stocking type filter
+                                               ---===========================================================================================================
                                          ,_t as ( --select t_.ItemNumber,t_.Date,t_.FCDate_,t_.FC_Vol,t_.PO_Vol,t_.SOH_Vol,t_.SOH_Vol_,t_.Final_SOH_Begin_M_,t_.SOH_End_M_,m.WholeSalePrice     -- will spit out column by coles the performance issue ? Not really  -- 14/5/2018
                                                                        select t_.*
                                                                                        , mm.WholeSalePrice as Mywholesaleprice
@@ -168,13 +182,14 @@
                                                                                        end as Owner_
                                                                                   ,mm.PrimarySupplier,mm.Description,mm.FamilyGroup_,mm.Family_0,mm.Leadtime_Mth

                                                                        --from t_ left join JDE_DB_Alan.vw_Mast mm on t_.ItemNumber_f = mm.ItemNumber   )                               -- note that 'vw_Mast ' has clean data,est to use Inner Join ( see below for reason )  - 23/7/2018
-                                                                         from t_ inner join JDE_DB_Alan.vw_Mast mm on t_.ItemNumber_f = mm.ItemNumber                                  -- Use inner join to filter out SKUs nong up in HD using ML345 (HD), so SKUs against AWF will filter out ( like in CommonWealth Bank Proj - '7089895','709901' ) -- 23/7/2018
-                                                                       --  where mm.StockingType not in ('O','U')
+                                                                         from t_ inner join JDE_DB_Alan.vw_Mast mm on t_.ItemNumber_f = mm.ItemNumber                                  -- Use inner join to filter out SKUs nong up in HD using ML345 (HD) like '709895', so SKUs against AWF will filter out ( like in CommonWealth Bank Proj - '7089895','709901' ) -- 23/7/2018
+                                                                       --  where mm.StockingType not in ('O','U')                                                                                                             ter out discontinued SKU like '32.501.000' - project Comwlth Bank Project. Should keep sku has no sales history over last 12 months like '18.013.089'  in Proj RAMLER -- 7/8/2018
                                                                        --  where mm.StockingType in ('O','K','W','X','S','F','P','U','Q','Z','C','M','0','I')
                                                                          where mm.StockingType in ('K','W','X','S','F','P','Q','Z','C','M','0','I') --or mm.StockingType is null                                  -- this coulst to avoid issue of returning empty dataSet due to Null value --- 23/7/2018
                                                                                                )

-                                               -- select * from _t
+                                               -- select * from _t
+                                               --  where _t.ItemNumber_f in ('32.501.000','709895','82.691.909','18.013.089','42.210.031')
                                                        --where _t.ItemNumber in ('45.103.000','45.200.100','42.210.031')
                                                         -- where _t.ItemNumber in ('0751031003001H')
                                                         --order by _t.ItemNumber,_t.Date
@@ -199,8 +214,8 @@
                                                                --      select _t.ItemNumber,_t.Date d1,_t.FCDate_ d2,'Weeks_Cover2' as DataType,(_t.SOH_End_M_)/(_t.Avg_FC_Vol_Nxt8M/4) as value,_t.Stk_Out_Stauts,_t.Owner_,_rySupplier,_t.Description,_t.FamilyGroup_,_t.Family_0 from _t
                                                                   )

-                                        --select distinct com.ItemNumber_f from com
-                                        ,fcst as
+                                       -- select distinct com.ItemNumber_f from com
+                               ,fcst as
                                                 (select * from com
                                                         --where com.Stk_Out_Stauts in ('Y')
                                                           -- where com.ItemNumber in ('45.103.000','45.200.100')
@@ -220,83 +235,98 @@
                                                        -- and com.ItemNumber_f in  ( select splitdata from JDE_DB_Alan.dbo.fnSplitString(@Item_id,','))        --- No need in Mi_Raw since you only pick up Forecast, but if yeneric Mismatch it is good to have alternative to choose ItemNumber --- 25/7/2018

                                                        --order by com.ItemNumber_f,com.DataType,com.d2
-                                                          )
-
-                                         select fcst.ItemNumber_f,fcst.d1,fcst.d2,fcst.DataType,fcst.value,fcst.Stk_Out_Stauts,fcst.Owner_,fcst.PrimarySupplier,fcst.Leadtime_Mth,fcst.PlannerNumber
-                                          from fcst
-                                          order by fcst.ItemNumber_f
-
-
+                                                          )
+                                         --select * from fcst where fcst.ItemNumber_f is null
+                                         --where fcst.ItemNumber_f in ('18.010.035')
+
+
                                  --- Get Preparation to Pivot Data using SQL --- It is better to use Numbwe Array ([1],[2],[3] ) instead of ([201807],[201808],[201809]) as it is more versatile and flexible to avoid hard co- 25/7/2018
-                               --,R(N,_T,T_,T,XX,YY,start) AS
-                               --              (
-                               --               select 1 as N,-24 as _T,24 as T_,-23 as T,24 as XX,24 as YY,cast(DATEADD(mm, DATEDIFF(mm, 0, GETDATE())-24, 0) as datetime) as start      -- pay attention T starts -23,you ne so you can get XXX Column/Field in current month you start as 1, otherwise you can use XX field
-                               --               UNION ALL
-                               --               select  N+1, _T+1,T_-1,case when T+1<0 then T+1 else case when T+1 =0 then 1 else T+1 end end as T
-                               --                                                              ,case when N >= 24  then _T+1
-                               --                                                                 else
-                               --                                                                         XX-1
-                               --                                                                      end as XX
-                               --                                                               ,case when N >= 24  then T
-                               --                                                                 else
-                               --                                                                         YY-1
-                               --                                                                      end as YY
-                               --                               ,dateadd(mm,1,start)
-                               --                from R
-                               --               where N < 49
-                               --              )
-                               --      --select * from r
-                               --      --select R.N,case when R._T < 0 then R.T_ else R._T end as T, start from R
-                               --      --select R.N,case when R._T < 0 then R.T_ else R.YY end as T, start from R
-                               --  ,MthCal as (
-                               --                                      select  n as rnk
-                               --                                       ,YY
-                               --                                      ,_T
-                               --                                      ,cast(SUBSTRING(REPLACE(CONVERT(char(10),start,126),'-',''),1,6) as integer) as [StartDt]
-                               --                                      ,LEFT(datename(month,start),3) AS [month_name]
-                               --                                      ,datepart(month,start) AS [month]
-                               --                                      ,datepart(year,start) AS [year]
-                               --                                 from R  )
-                               -- --select * from MthCal
+                               ,R(N,_T,T_,T,XX,YY,start) AS
+                                               (
+                                                select 1 as N,-24 as _T,24 as T_,-23 as T,24 as XX,24 as YY,cast(DATEADD(mm, DATEDIFF(mm, 0, GETDATE())-24, 0) as datetime) as start      -- pay attention T starts -23,you ne so you can get XXX Column/Field in current month you start as 1, otherwise you can use XX field
+                                                UNION ALL
+                                                select  N+1, _T+1,T_-1,case when T+1<0 then T+1 else case when T+1 =0 then 1 else T+1 end end as T
+                                                                                               ,case when N >= 24  then _T+1
+                                                                                                  else
+                                                                                                          XX-1
+                                                                                                       end as XX
+                                                                                                ,case when N >= 24  then T
+                                                                                                  else
+                                                                                                          YY-1
+                                                                                                       end as YY
+                                                                ,dateadd(mm,1,start)
+                                                 from R
+                                                where N < 49
+                                               )
+                                       --select * from r
+                                       --select R.N,case when R._T < 0 then R.T_ else R._T end as T, start from R
+                                       --select R.N,case when R._T < 0 then R.T_ else R.YY end as T, start from R
+                                 ,MthCal as (
+                                                                       select  n as rnk
+                                                                        ,YY
+                                                                       ,_T
+                                                                       ,cast(SUBSTRING(REPLACE(CONVERT(char(10),start,126),'-',''),1,6) as integer) as [StartDt]
+                                                                       ,LEFT(datename(month,start),3) AS [month_name]
+                                                                       ,datepart(month,start) AS [month]
+                                                                       ,datepart(year,start) AS [year]
+                                                                  from R  )
+                                --select * from MthCal

-                               -- --- Need to Pivot data to display in Horizontal way --- Need to think it to join Calendar table ( with integer t number ) rather using [201808],[201809] instead using [1],[2] to speed up en time,also to avoid hard coding !
+                                --- Need to Pivot data to display in Horizontal way --- Need to think it to join Calendar table ( with integer t number ) rather using [201808],[201809] instead using [1],[2] to speed up exetime,also to avoid hard coding !

-                        --,fcst_ as ( select f.ItemNumber_f,f.Description,f.d1,f.d3,f.d2,f.Value
-                               --                              ,c.*                                                                                                                                                           in cal to get YY value which is your month rank/order
+                        ,_fcst as ( select f.ItemNumber_f,f.Description,f.d1,f.d3,f.d2,f.Value
+                                                               ,c.*                                                                                                                                                           in cal to get YY value which is your month rank/order

-                               --              from fcst f left join MthCal c on f.d3 = c.StartDt                                                                                              --- no need to cross join cal t FC tb always has data in 24 mth
-                               --        -- where fc.ItemNumber = ('42.210.031') order by fc.ItemNumber,fc.StartDt,fc.Date
-                               --              )
+                                               from fcst f left join MthCal c on f.d3 = c.StartDt                                                                                              --- no need to cross join cal t FC tb always has data in 24 mth
+                                         -- where fc.ItemNumber = ('42.210.031') order by fc.ItemNumber,fc.StartDt,fc.Date
+                                               )

-    --          -- select * from fcst_
+              --select * from fcst_  f where f.ItemNumber_f in ('18.010.035')

-                               --, mypvt as
-                               --      ( select *
-                               --               from
-                               --                              ( select f.ItemNumber_f,f.Description,f._T,f.Value  from fcst_ f  ) as sourcetb
-    --                     pivot
-                               --                     ( sum(value) for _T in ( [0],[1],[2],[3],[4],[5],[6],[7],[8],[9],[10],[11])
-                               --                              ) as p
-                               --      )
+
+                         -- Need to Join back Original to get Data for only MI Month you Need --- 3/8/2018
+                       ,mi2fc_ as ( select f.ItemID,f.Date,f.ValidStatus,f.value as Value_Orig from mi2fc f)
+                       ,fcst_ as ( select *
+                                           from mi2fc_ myf left join _fcst f on myf.ItemID = f.ItemNumber_f and myf.Date = f.d1
+                                               )
+               -- select * from _fcst f where f.ItemNumber_f is null
+
+                               , mypvt as
+                                       ( select *
+                                                from
+                                                               ( select f.ItemNumber_f,f.Description,f._T,f.Value  from fcst_ f  ) as sourcetb
+                         pivot
+                                                      ( sum(value) for _T in ( [0],[1],[2],[3],[4],[5],[6],[7],[8],[9],[10],[11])
+                                                               ) as p
+                                       )


-                               --select pv.ItemNumber_f
-                               --         ,pv.Description
-                               --         ,isnull(pv.[0],0) [0]
-                               --         ,isnull(pv.[1],0) [1]
-                               --         ,isnull(pv.[2],0) [2]
-                               --         ,isnull(pv.[3],0) [3]
-                               --         ,isnull(pv.[4],0) [4]
-                               --         ,isnull(pv.[5],0) [5]
-                               --         ,isnull(pv.[6],0) [6]
-                               --         ,isnull(pv.[7],0) [7]
-                               --         ,isnull(pv.[8],0) [8]
-                               --         ,isnull(pv.[9],0) [9]
-                               --         ,isnull(pv.[10],0) [10]
-                               --         ,isnull(pv.[11],0) [11]
+                               select pv.ItemNumber_f
+                                          ,pv.Description
+                                          ,'Market Intelligence_2' as DataType
+                                          ,'TBC' as ChangeNoticeNumber
+                                          , 'Check_Original_Raw' as Comment
+                                          , 'TBC' as Creator
+                                          , 'TBC' as RefNum
+                                          , 'Y' as ValidStatus
+                                          , getdate() as LastUpdated
+                                          ,isnull(pv.[0],0) [0]
+                                          ,isnull(pv.[1],0) [1]
+                                          ,isnull(pv.[2],0) [2]
+                                          ,isnull(pv.[3],0) [3]
+                                          ,isnull(pv.[4],0) [4]
+                                          ,isnull(pv.[5],0) [5]
+                                          ,isnull(pv.[6],0) [6]
+                                          ,isnull(pv.[7],0) [7]
+                                          ,isnull(pv.[8],0) [8]
+                                          ,isnull(pv.[9],0) [9]
+                                          ,isnull(pv.[10],0) [10]
+                                          ,isnull(pv.[11],0) [11]

-                               -- from mypvt pv
-                               -- order by pv.ItemNumber_f
+                                from mypvt pv
+                               -- where pv.ItemNumber_f in ('18.013.089')
+                               --where pv.ItemNumber_f is null
+                                order by pv.ItemNumber_f


                                --, mypvt as

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ ls
Git_Cmd_History.c  Git_Cmd_History.txt  Git_Cmd_Knowledgebase.docx  GWF_VBA_Code_Work.xlsm  MI_Code.txt  MI_Sim_Code.txt  README.md  VBA_Button_On_Excel.xlsx

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ ls -la
total 3362
drwxr-xr-x 1 yaoa 1049089       0 Aug  8 10:36 ./
drwxr-xr-x 1 yaoa 1049089       0 Aug  6 13:28 ../
drwxr-xr-x 1 yaoa 1049089       0 Aug  7 15:31 .git/
-rw-r--r-- 1 yaoa 1049089       3 Aug  7 12:32 .gitignore
-rw-r--r-- 1 yaoa 1049089   36714 Aug  6 14:27 Git_Cmd_History.c
-rw-r--r-- 1 yaoa 1049089   36714 Aug  7 12:20 Git_Cmd_History.txt
-rw-r--r-- 1 yaoa 1049089   18493 Aug  8 10:36 Git_Cmd_Knowledgebase.docx
-rw-r--r-- 1 yaoa 1049089 3108880 Aug  7 14:23 GWF_VBA_Code_Work.xlsm
-rw-r--r-- 1 yaoa 1049089   25989 Aug  7 14:26 MI_Code.txt
-rw-r--r-- 1 yaoa 1049089   25065 Aug  7 15:31 MI_Sim_Code.txt
-rw-r--r-- 1 yaoa 1049089      29 Aug  6 13:27 README.md
-rw-r--r-- 1 yaoa 1049089  164065 Aug  7 12:07 VBA_Button_On_Excel.xlsx

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git rm git_cmd_history.txt
fatal: pathspec 'git_cmd_history.txt' did not match any files

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ git rm Git_Cmd_History.txt
rm 'Git_Cmd_History.txt'

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ ls -la
total 3326
drwxr-xr-x 1 yaoa 1049089       0 Aug  8 11:20 ./
drwxr-xr-x 1 yaoa 1049089       0 Aug  6 13:28 ../
drwxr-xr-x 1 yaoa 1049089       0 Aug  8 11:20 .git/
-rw-r--r-- 1 yaoa 1049089       3 Aug  7 12:32 .gitignore
-rw-r--r-- 1 yaoa 1049089   36714 Aug  6 14:27 Git_Cmd_History.c
-rw-r--r-- 1 yaoa 1049089   18493 Aug  8 10:36 Git_Cmd_Knowledgebase.docx
-rw-r--r-- 1 yaoa 1049089 3108880 Aug  7 14:23 GWF_VBA_Code_Work.xlsm
-rw-r--r-- 1 yaoa 1049089   25989 Aug  7 14:26 MI_Code.txt
-rw-r--r-- 1 yaoa 1049089   25065 Aug  7 15:31 MI_Sim_Code.txt
-rw-r--r-- 1 yaoa 1049089      29 Aug  6 13:27 README.md
-rw-r--r-- 1 yaoa 1049089  164065 Aug  7 12:07 VBA_Button_On_Excel.xlsx

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$


------------------------------------------------------------------------------------------------------------------------------------------
--- Git Command Up to 8/8/2018 11:21AM --

yaoa@RYDWS366 MINGW64 ~/Alan_HD/Alan_Work/HD_IT/HD_VBA/vba (master)
$ history
    1*
    2  git status
    3  cd vba
    4  git status
    5  git add -A
    6  git status
    7  git commit -m " Add VBA master code file to Github account"
    8  git push
    9  git status
   10  git add .
   11  git commit -m "add Git_Cmd history file & Knowledgebase file"
   12  git push
   13  git add .gitignore
   14  touch .gitignore
   15  git status
   16  git add .gitignore
   17  git status
   18  git add .
   19  git add .
   20  git add .
   21  git status
   22  git commit -m "add VBA button file & .gitignore file"
   23  git push
   24  git status
   25  git add .
   26  git add .
   27  git status
   28  git commit -m "add Git_Cmd_History.txt file and hide/ignore Git_Cmd_History.c file"
   29  git push
   30  git status
   31  git status
   32  git add .
   33  git status
   34  git commit -m "add star to .gitignore"
   35  git push
   36  git status
   37  git status
   38  git add .
   39  git status
   40  git commit -m "add MI_Code.txt"
   41  git push
   42  git status
   43  git diff
   44  git status
   45  git add .
   46  git status
   47  git commit -m "add MI_Simulation_Code.txt"
   48  push
   49  git push
   50  git status
   51  git diff
   52  ls
   53  ls -la
   54  git rm git_cmd_history.txt
   55  git rm Git_Cmd_History.txt
   56  ls -la
   57  doskey /history
   58  history

